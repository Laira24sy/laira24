<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ÿßŸÑŸÑŸäÿ±ÿ© 24</title>

    <link rel="manifest" href="./manifest.json">
    <meta name="theme-color" content="#163300">
    <link rel="apple-touch-icon" href="./assets/icon.png">

    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            font-family: 'Cairo', sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
            overscroll-behavior-y: none;
            background-color: #f8fafc;
            color: #1e293b;
        }

        .dark body {
            background-color: #0f172a;
            color: #f1f5f9;
        }

        input,
        textarea,
        select {
            -webkit-user-select: text;
            user-select: text;
        }

        .num-en {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            direction: ltr;
            display: inline-block;
        }

        /* Essential Scrollbar Reset */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* --- Unified Card System --- */
        .app-card {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 1.25rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05), 0 1px 2px rgba(0, 0, 0, 0.02);
            transition: all 0.2s ease;
        }

        .dark .app-card {
            background: #1e293b;
            border-color: #334155;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }

        .app-card-interactive:active {
            transform: scale(0.98);
            background-color: #f1f5f9;
        }

        .dark .app-card-interactive:active {
            background-color: #334155;
        }

        /* --- Unified Button System --- */
        .btn-primary {
            background: #10b981;
            color: white;
            font-weight: 700;
            border-radius: 1rem;
            padding: 1rem;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary:active {
            transform: scale(0.96);
            opacity: 0.9;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            font-weight: 600;
            border-radius: 1rem;
            padding: 0.75rem 1rem;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .dark .btn-secondary {
            background: #334155;
            color: #e2e8f0;
        }

        /* --- Input System --- */
        .app-input {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            border-radius: 1rem;
            padding: 0.875rem 1.125rem;
            width: 100%;
            outline: none;
            transition: all 0.2s ease;
            font-weight: 600;
        }

        .dark .app-input {
            background: #0f172a;
            border-color: #1e293b;
            color: white;
        }

        .app-input:focus {
            border-color: #10b981;
            box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
        }

        /* --- Custom Background (Professional Subtle) --- */
        .bg-mesh-transfer,
        .mesh-bg {
            display: none;
            /* Removed flashy meshes as requested */
        }

        .page-container {
            padding: 1.5rem;
            padding-bottom: 6rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Animations */
        .animate-slide-up {
            animation: slideUp 0.4s cubic-bezier(0, 0, 0.2, 1) forwards;
        }

        @keyframes slideUp {
            from {
                transform: translateY(20px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Currency Up/Down Indicators */
        .rate-indicator {
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .rate-up {
            background: #ecfdf5;
            color: #10b981;
        }

        .rate-down {
            background: #fef2f2;
            color: #ef4444;
        }

        .dark .rate-up {
            background: rgba(16, 185, 129, 0.1);
        }

        .dark .rate-down {
            background: rgba(239, 68, 68, 0.1);
        }
    </style>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            dark: '#163300',
                            primary: '#2ed06e',
                            light: '#9fe870',
                            bg: '#f3f4f6',
                            card: '#ffffff'
                        }
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-transparent text-gray-900 transition-colors duration-300" oncontextmenu="return false;">
    <div id="root"></div>

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => console.log('SW Registered!', reg))
                    .catch(err => console.log('SW Failed', err));
            });
        }
    </script>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Config ---
        const SUPABASE_URL = "https://xcmovzkbpumvufvmahew.supabase.co";
        const ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhjbW92emticHVtdnVmdm1haGV3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MTc2MjYsImV4cCI6MjA3OTE5MzYyNn0.aLxh6TSQ6pznFoeWpgnbdDYv1eJBNKtcdonyLhzJUZs";
        const CURRENCY_API_KEY = "cur_live_CDxQbX4wFRag1Je6lH4NbngQ3ifR7dRF4bQR6azA";
        const GLOBAL_CACHE_DURATION = 45 * 60 * 1000;
        const SPREAD_PERCENTAGE = 0.002;

        const GLOBAL_DISPLAY_MAP = {
            USD: { name: "ÿØŸàŸÑÿßÿ± ÿ£ŸÖÿ±ŸäŸÉŸä", flag: "üá∫üá∏" },
            EUR: { name: "ŸäŸàÿ±Ÿà", flag: "üá™üá∫" },
            GBP: { name: "ÿ¨ŸÜŸäŸá ÿ•ÿ≥ÿ™ÿ±ŸÑŸäŸÜŸä", flag: "üá¨üáß" },
            TRY: { name: "ŸÑŸäÿ±ÿ© ÿ™ÿ±ŸÉŸäÿ©", flag: "üáπüá∑" },
            SAR: { name: "ÿ±ŸäÿßŸÑ ÿ≥ÿπŸàÿØŸä", flag: "üá∏üá¶" },
            AED: { name: "ÿØÿ±ŸáŸÖ ÿ•ŸÖÿßÿ±ÿßÿ™Ÿä", flag: "üá¶üá™" },
            KWD: { name: "ÿØŸäŸÜÿßÿ± ŸÉŸàŸäÿ™Ÿä", flag: "üá∞üáº" },
            QAR: { name: "ÿ±ŸäÿßŸÑ ŸÇÿ∑ÿ±Ÿä", flag: "üá∂üá¶" },
            JOD: { name: "ÿØŸäŸÜÿßÿ± ÿ£ÿ±ÿØŸÜŸä", flag: "üáØüá¥" },
            CAD: { name: "ÿØŸàŸÑÿßÿ± ŸÉŸÜÿØŸä", flag: "üá®üá¶" },
            AUD: { name: "ÿØŸàŸÑÿßÿ± ÿ£ÿ≥ÿ™ÿ±ÿßŸÑŸä", flag: "üá¶üá∫" },
            JPY: { name: "ŸäŸÜ Ÿäÿßÿ®ÿßŸÜŸä", flag: "üáØüáµ" },
            RUB: { name: "ÿ±Ÿàÿ®ŸÑ ÿ±Ÿàÿ≥Ÿä", flag: "üá∑üá∫" },
            CNY: { name: "ŸäŸàÿßŸÜ ÿµŸäŸÜŸä", flag: "üá®üá≥" }
        };

        // ********** API **********
        async function fetchSupabaseData(viewName) {
            try {
                const url = `${SUPABASE_URL}/rest/v1/${viewName}?select=*`;
                const res = await fetch(url, {
                    headers: { "apikey": ANON_KEY, "Authorization": "Bearer " + ANON_KEY },
                    cache: 'reload'
                });
                if (!res.ok) return [];
                return await res.json();
            } catch (error) {
                console.error("Error fetching data:", error);
                return [];
            }
        }

        // --- Icons ---
        const Icons = {
            Home: () => <i data-lucide="home" className="w-6 h-6"></i>,
            Chart: () => <i data-lucide="bar-chart-2" className="w-6 h-6"></i>,
            Send: () => <i data-lucide="send" className="w-6 h-6"></i>,
            Coins: () => <i data-lucide="coins" className="w-6 h-6"></i>,
            Settings: () => <i data-lucide="settings" className="w-5 h-5"></i>,
            Globe: () => <i data-lucide="globe" className="w-6 h-6"></i>,
            Refresh: () => <i data-lucide="refresh-cw" className="w-4 h-4"></i>,
            Moon: () => <i data-lucide="moon" className="w-5 h-5"></i>,
            Sun: () => <i data-lucide="sun" className="w-5 h-5"></i>,
            Check: () => <i data-lucide="check" className="w-4 h-4"></i>,
            Calculator: () => <i data-lucide="calculator" className="w-5 h-5"></i>,
            TrendUp: () => <i data-lucide="trending-up" className="w-3 h-3"></i>,
            TrendDown: () => <i data-lucide="trending-down" className="w-3 h-3"></i>,
            Minus: () => <i data-lucide="minus" className="w-3 h-3"></i>,
            Shield: () => <i data-lucide="shield-check" className="w-6 h-6"></i>,
            Zap: () => <i data-lucide="zap" className="w-6 h-6"></i>,
            Wallet: () => <i data-lucide="wallet" className="w-6 h-6"></i>,
            X: () => <i data-lucide="x" className="w-5 h-5"></i>,
            Clock: () => <i data-lucide="clock" className="w-4 h-4"></i>,
            Target: () => <i data-lucide="target" className="w-4 h-4"></i>,
            ArrowDownUp: () => <i data-lucide="arrow-up-down" className="w-4 h-4"></i>,
            Download: () => <i data-lucide="download" className="w-5 h-5"></i>,
            Move: () => <i data-lucide="move" className="w-4 h-4"></i>,
            ArrowUp: () => <i data-lucide="arrow-up" className="w-5 h-5"></i>,
            ArrowDown: () => <i data-lucide="arrow-down" className="w-5 h-5"></i>,
            Info: () => <i data-lucide="info" className="w-4 h-4"></i>,
            Gem: () => <i data-lucide="gem" className="w-4 h-4"></i>,
            Camera: () => <i data-lucide="camera" className="w-4 h-4"></i>,
            Facebook: () => <i data-lucide="facebook" className="w-6 h-6"></i>,
            Share: () => <i data-lucide="share-2" className="w-4 h-4"></i>,
            Smartphone: () => <i data-lucide="smartphone" className="w-6 h-6"></i>,
            ArrowLeft: () => <i data-lucide="arrow-left" className="w-5 h-5"></i>,
            Telegram: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="lucide lucide-send"><path d="m22 2-7 20-4-9-9-4Z" /><path d="M22 2 11 13" /></svg>,
            Copy: () => <i data-lucide="copy" className="w-4 h-4"></i>,
            Fuel: () => <i data-lucide="fuel" className="w-6 h-6"></i>,
            Droplet: () => <i data-lucide="droplet" className="w-6 h-6"></i>
        };

        const IconRenderer = ({ icon }) => {
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            });
            return <span className="inline-flex items-center justify-center icon-wrapper">
                {icon()}
            </span>;
        };

        // --- SCREENSHOT LOGIC ---
        const handleScreenshot = async (targetId, title) => {
            const element = document.getElementById(targetId);
            if (!element) return;

            window.scrollTo(0, 0);

            try {
                await new Promise(resolve => setTimeout(resolve, 300));

                const canvas = await html2canvas(element, {
                    scale: 3,
                    useCORS: true,
                    backgroundColor: null,
                    allowTaint: true,
                    logging: false,
                    letterRendering: 1,
                    onclone: (clonedDoc) => {
                        const clonedElement = clonedDoc.getElementById(targetId);
                        if (clonedElement) {
                            clonedElement.style.display = "flex";
                            clonedElement.style.visibility = "visible";
                            clonedElement.style.fontFamily = "'Cairo', sans-serif";
                            clonedElement.setAttribute('dir', 'rtl');
                        }
                    }
                });

                const link = document.createElement('a');
                link.download = `Lira24-${title.replace(/\s+/g, '-')}-${new Date().getTime()}.png`;
                link.href = canvas.toDataURL('image/png', 1.0);
                link.click();
            } catch (error) {
                console.error("Screenshot failed:", error);
                alert("ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ≠ŸÅÿ∏ ÿßŸÑÿµŸàÿ±ÿ©");
            }
        };

        // --- Components ---
        const generateChartData = (basePrice, points = 20, volatility = 0.02) => {
            let data = [];
            let current = basePrice;
            for (let i = 0; i < points; i++) {
                if (i === points - 1) data.push(basePrice);
                else {
                    const change = current * (Math.random() * volatility - (volatility / 2));
                    current += change;
                    data.push(current);
                }
            }
            return data;
        };

        const LineChart = ({ data, color = "#2ed06e", height = 120, showAxis = true }) => {
            if (!data || data.length === 0) return null;
            const width = 300;
            const padding = 5;
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min || 1;
            const points = data.map((val, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((val - min) / range) * (height - padding * 2) - padding;
                return `${x},${y}`;
            }).join(' ');
            const areaPoints = `${points} ${width},${height} 0,${height}`;

            return (
                <div className="w-full relative select-none" style={{ height: height + 'px' }}>
                    <svg viewBox={`0 0 ${width} ${height}`} className="w-full h-full overflow-visible">
                        <defs>
                            <linearGradient id={`chartGradient-${color}`} x1="0" x2="0" y1="0" y2="1">
                                <stop offset="0%" stopColor={color} stopOpacity="0.4" />
                                <stop offset="100%" stopColor={color} stopOpacity="0" />
                            </linearGradient>
                        </defs>
                        <path d={`M ${areaPoints}`} fill={`url(#chartGradient-${color})`} stroke="none" />
                        <path d={`M ${points}`} fill="none" stroke={color} strokeWidth="3" strokeLinecap="round" strokeLinejoin="round" className="chart-path" />
                        <circle cx={width} cy={height - ((data[data.length - 1] - min) / range) * (height - padding * 2) - padding} r="4" fill={color} stroke="white" strokeWidth="2" />
                    </svg>
                    {showAxis && (
                        <>
                            <div className="absolute top-0 left-0 text-[10px] text-gray-400 font-mono bg-white/80 dark:bg-gray-800/80 px-1 rounded">High: {max.toLocaleString('en-US', { maximumFractionDigits: 0 })}</div>
                            <div className="absolute bottom-0 left-0 text-[10px] text-gray-400 font-mono bg-white/80 dark:bg-gray-800/80 px-1 rounded">Low: {min.toLocaleString('en-US', { maximumFractionDigits: 0 })}</div>
                        </>
                    )}
                </div>
            );
        };

        const formatLastUpdate = (dateObj) => {
            if (!dateObj) return "Now";
            return dateObj.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
        };

        const formatDateForExport = (dateObj) => {
            if (!dateObj) return "";
            const day = dateObj.getDate();
            const month = dateObj.getMonth() + 1;
            const year = dateObj.getFullYear();
            return `${year}/${month}/${day}`;
        };

        const calculateChange = (currentPrice, previousPrice) => {
            if (!previousPrice || parseFloat(previousPrice) === 0) return { percent: 0, direction: 'neutral' };
            const oldPrice = parseFloat(previousPrice);
            const current = parseFloat(currentPrice);
            const diff = current - oldPrice;
            const percent = (diff / oldPrice) * 100;
            return { percent: Math.abs(percent).toFixed(2), direction: diff > 0 ? 'up' : 'down' };
        };

        const getFlagAndCode = (name) => {
            if (name.includes("ÿØŸàŸÑÿßÿ±")) return { flag: "üá∫üá∏", code: "USD" };
            if (name.includes("ŸäŸàÿ±Ÿà")) return { flag: "üá™üá∫", code: "EUR" };
            if (name.includes("ÿ™ÿ±ŸÉŸä")) return { flag: "üáπüá∑", code: "TRY" };
            if (name.includes("ÿ≥ÿπŸàÿØŸä")) return { flag: "üá∏üá¶", code: "SAR" };
            if (name.includes("ÿ•ŸÖÿßÿ±ÿßÿ™Ÿä")) return { flag: "üá¶üá™", code: "AED" };
            if (name.includes("ÿ£ÿ±ÿØŸÜŸä")) return { flag: "üáØüá¥", code: "JOD" };
            if (name.includes("ŸÖÿµÿ±Ÿä")) return { flag: "üá™üá¨", code: "EGP" };
            if (name.includes("ŸÉŸàŸäÿ™Ÿä")) return { flag: "üá∞üáº", code: "KWD" };
            if (name.includes("ÿ∞Ÿáÿ®")) return { flag: "üèÜ", code: "GOLD" };
            return { flag: "üåç", code: "GBL" };
        };

        // --- Elegant Close Button ---
        const ElegantCloseButton = ({ onClick }) => (
            <button
                onClick={onClick}
                className="screenshot-exclude group relative flex items-center justify-center w-10 h-10 rounded-full bg-white/60 dark:bg-gray-800/60 backdrop-blur-md border border-gray-200/50 dark:border-gray-600/50 shadow-sm transition-all duration-300 hover:bg-red-50 hover:border-red-200 hover:text-red-500 dark:hover:bg-red-900/20 dark:hover:border-red-900/30 dark:hover:text-red-400 hover:scale-110 active:scale-95 z-50"
            >
                <div className="transition-transform duration-300 group-hover:rotate-90">
                    <IconRenderer icon={Icons.X} />
                </div>
            </button>
        );

        // --- REDESIGNED PROMO EXPORT CARD (Fixed Layout & Arabic Text) ---
        const PromoExportCard = ({ id, title, subTitle, icon, code, sell, buy, time, isUsd, isGold, sellLabel, buyLabel, sellPrefix, buyPrefix }) => {
            return (
                <div
                    id={id}
                    style={{
                        position: 'fixed',
                        top: 0,
                        left: '-9999px',
                        width: '1080px',
                        height: '1080px',
                        zIndex: -1,
                        backgroundColor: '#0f172a',
                        fontFamily: "'Cairo', sans-serif",
                        direction: 'rtl',
                        display: 'flex',
                        flexDirection: 'column',
                        overflow: 'hidden'
                    }}
                >
                    <div className="absolute inset-0 opacity-10">
                        <svg width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <pattern id="grid" width="80" height="80" patternUnits="userSpaceOnUse">
                                    <path d="M 80 0 L 0 0 0 80" fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth="1" />
                                </pattern>
                            </defs>
                            <rect width="100%" height="100%" fill="url(#grid)" />
                        </svg>
                    </div>

                    <div className="absolute top-0 right-0 w-[800px] h-[800px] bg-brand-primary/10 rounded-full blur-[150px] -translate-y-1/2 translate-x-1/2"></div>
                    <div className="absolute bottom-0 left-0 w-[600px] h-[600px] bg-brand-light/5 rounded-full blur-[120px] translate-y-1/2 -translate-x-1/2"></div>

                    <div className="flex justify-between items-center p-16 relative z-10">
                        <div className="flex items-center gap-6">
                            <div className="w-20 h-20 bg-brand-primary rounded-3xl flex items-center justify-center shadow-2xl shadow-brand-primary/20">
                                <span className="text-brand-dark font-black text-4xl">24</span>
                            </div>
                            <div>
                                <h1 className="text-white text-5xl font-black mb-1">ÿßŸÑŸÑŸäÿ±ÿ© 24</h1>
                                <p className="text-brand-primary text-xl font-bold tracking-[0.2em] uppercase opacity-80">Market Intelligence</p>
                            </div>
                        </div>
                        <div className="bg-white/5 border border-white/10 px-10 py-5 rounded-3xl backdrop-blur-md">
                            <span className="text-gray-300 font-bold text-3xl num-en">{formatDateForExport(time)}</span>
                        </div>
                    </div>

                    <div className="flex-1 flex flex-col items-center justify-center relative z-10 px-20">
                        <div className="mb-20 relative">
                            <div className="w-56 h-56 rounded-full bg-white/5 border border-white/10 flex items-center justify-center text-[9rem] shadow-2xl backdrop-blur-sm relative z-10 pb-4">
                                {icon}
                            </div>
                            <div className="absolute -bottom-6 left-1/2 -translate-x-1/2 bg-brand-primary text-brand-dark font-black text-3xl px-12 py-3 rounded-2xl shadow-2xl border-4 border-[#0f172a]">
                                {code}
                            </div>
                        </div>

                        <div className="text-center mb-24">
                            <h2 className="text-white text-7xl font-black mb-4 leading-tight">{title}</h2>
                            <p className="text-gray-400 text-4xl font-medium">{subTitle}</p>
                        </div>

                        <div className="flex gap-12 w-full max-w-6xl">
                            <div className="flex-1 bg-white/5 border border-white/10 rounded-[4rem] p-12 flex flex-col items-center justify-center relative overflow-hidden backdrop-blur-xl">
                                <div className="absolute top-0 left-0 w-full h-4 bg-red-500 shadow-[0_0_30px_rgba(239,68,68,0.4)]"></div>
                                <div className="flex items-center gap-4 bg-red-500/10 px-6 py-3 rounded-full border border-red-500/20 mb-8">
                                    <span className="text-gray-300 text-3xl font-bold">{sellLabel || "ÿ≥ÿπÿ± ÿßŸÑŸÖÿ®Ÿäÿπ"}</span>
                                </div>
                                <span className="text-white text-9xl font-black num-en tracking-tighter drop-shadow-2xl">
                                    {sellPrefix !== undefined ? sellPrefix : (isUsd ? '$' : '')}{parseFloat(sell).toLocaleString('en-US')}
                                </span>
                            </div>

                            <div className="flex-1 bg-white/5 border border-white/10 rounded-[4rem] p-12 flex flex-col items-center justify-center relative overflow-hidden backdrop-blur-xl">
                                <div className="absolute top-0 left-0 w-full h-4 bg-brand-primary shadow-[0_0_30px_rgba(46,208,110,0.4)]"></div>
                                <div className="flex items-center gap-4 bg-brand-primary/10 px-6 py-3 rounded-full border border-brand-primary/20 mb-8">
                                    <span className="text-brand-light text-3xl font-bold">{buyLabel || "ÿ≥ÿπÿ± ÿßŸÑÿ¥ÿ±ÿßÿ°"}</span>
                                </div>
                                <span className="text-brand-primary text-9xl font-black num-en tracking-tighter drop-shadow-2xl">
                                    {buyPrefix !== undefined ? buyPrefix : (isUsd ? '$' : '')}{parseFloat(buy).toLocaleString('en-US')}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div className="p-16 relative z-10 mt-auto">
                        <div className="bg-white/5 backdrop-blur-xl rounded-[3rem] p-10 border border-white/10 flex justify-between items-center shadow-2xl">
                            <div className="flex items-center gap-8">
                                <div className="bg-[#229ED9] w-20 h-20 rounded-3xl flex items-center justify-center shadow-2xl rotate-3">
                                    <svg viewBox="0 0 24 24" fill="white" width="48" height="48"><path d="m20.665 3.717-17.73 6.837c-1.21.486-1.203 1.161-.222 1.462l4.552 1.42 10.532-6.645c.498-.303.953-.14.579.192l-8.533 7.701h-.002l.002.001-.314 4.692c.46 0 .663-.211.921-.46l2.211-2.15 4.599 3.397c.848.467 1.457.227 1.668-.785l3.019-14.228c.309-1.239-.473-1.8-1.282-1.434z"></path></svg>
                                </div>
                                <div>
                                    <p className="text-gray-400 text-2xl font-bold mb-2 uppercase tracking-widest">Join our community</p>
                                    <p className="text-white text-4xl font-black num-en">t.me/Lairas24</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-8 border-r-2 border-white/10 pr-12">
                                <div className="text-left">
                                    <p className="text-brand-primary text-3xl font-black mb-1">DOWNLOAD NOW</p>
                                    <p className="text-gray-400 text-xl font-bold">Lira24 on iOS & Android</p>
                                </div>
                                <div className="w-20 h-20 bg-white rounded-3xl flex items-center justify-center shadow-2xl -rotate-3 p-3">
                                    <img src="./assets/icon.png" alt="App" className="w-full h-full object-contain" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Currency Modal ---
        const CurrencyDetailModal = ({ currency, onClose, onMove, time }) => {
            if (!currency) return null;
            const { flag, code } = getFlagAndCode(currency.name);
            const isUp = currency.stats?.direction === 'up';
            const sell = parseFloat(currency.sell_price);
            const buy = parseFloat(currency.buy_price);
            const reverseRate = sell > 0 ? (1 / sell).toFixed(7) : 0;
            const chartData = useMemo(() => generateChartData(sell, 15, 0.01), [sell]);
            const exportId = `export-currency-${code}`;

            return (
                <div className="fixed inset-0 z-[70] flex items-end sm:items-center justify-center bg-brand-dark/40 dark:bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-300" onClick={onClose}>
                    <PromoExportCard id={exportId} title={currency.name} subTitle={`ŸÖŸÇÿßÿ®ŸÑ ÿßŸÑŸÑŸäÿ±ÿ© ÿßŸÑÿ≥Ÿàÿ±Ÿäÿ©`} icon={flag} code={code} sell={sell} buy={buy} time={time} isUsd={false} isGold={false} />

                    <div className="app-card w-full max-w-sm p-0 overflow-hidden animate-in zoom-in-95 slide-in-from-bottom-10 duration-300 relative" onClick={e => e.stopPropagation()}>
                        <div className="p-6">
                            <div className="flex justify-between items-start mb-6">
                                <div className="flex items-center gap-4">
                                    <div className="w-14 h-14 rounded-2xl bg-gray-50 dark:bg-slate-800 flex items-center justify-center text-3xl shadow-sm border border-gray-100 dark:border-slate-700">
                                        {flag}
                                    </div>
                                    <div>
                                        <h2 className="text-xl font-black text-gray-800 dark:text-white leading-tight">{currency.name}</h2>
                                        <div className="flex items-center gap-2 mt-1">
                                            <span className="text-[10px] font-bold text-gray-400 uppercase tracking-widest">{code}</span>
                                            <span className={`text-[10px] font-bold px-2 py-0.5 rounded-md ${isUp ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400' : 'bg-rose-100 text-rose-700 dark:bg-rose-900/40 dark:text-rose-400'}`}>
                                                {isUp ? '‚Üë' : '‚Üì'} {currency.stats.percent}%
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <ElegantCloseButton onClick={onClose} />
                            </div>

                            <div className="grid grid-cols-2 gap-4 mb-6">
                                <div className="bg-gray-50 dark:bg-slate-800/50 rounded-2xl p-4 border border-gray-100 dark:border-slate-700">
                                    <span className="text-[10px] text-gray-400 font-bold mb-1 block">ÿ≥ÿπÿ± ÿßŸÑŸÖÿ®Ÿäÿπ</span>
                                    <span className={`text-2xl font-black num-en ${isUp ? 'text-gray-800 dark:text-white' : 'text-rose-500'}`}>{sell.toLocaleString('en-US')}</span>
                                </div>
                                <div className="bg-brand-primary/5 dark:bg-brand-primary/10 rounded-2xl p-4 border border-brand-primary/20">
                                    <span className="text-[10px] text-brand-primary font-bold mb-1 block">ÿ≥ÿπÿ± ÿßŸÑÿ¥ÿ±ÿßÿ°</span>
                                    <span className="text-2xl font-black num-en text-brand-primary">{buy.toLocaleString('en-US')}</span>
                                </div>
                            </div>

                            <div className="mb-6">
                                <LineChart data={chartData} color={isUp ? "#10b981" : "#ef4444"} height={100} showAxis={false} />
                            </div>

                            <div className="space-y-4">
                                <div className="flex justify-between items-center bg-gray-50 dark:bg-slate-800/40 rounded-xl px-4 py-3 border border-gray-100 dark:border-slate-700">
                                    <div className="text-center flex-1">
                                        <span className="block text-[9px] text-gray-400 font-bold uppercase">ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´</span>
                                        <span className="block text-xs font-bold num-en text-gray-700 dark:text-gray-200">{formatLastUpdate(time)}</span>
                                    </div>
                                    <div className="w-px h-6 bg-gray-200 dark:bg-slate-700"></div>
                                    <div className="text-center flex-1">
                                        <span className="block text-[9px] text-gray-400 font-bold uppercase">ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿπŸÉÿ≥Ÿä</span>
                                        <span className="block text-xs font-bold num-en text-gray-700 dark:text-gray-200">{reverseRate}</span>
                                    </div>
                                </div>

                                <div className="flex gap-3">
                                    <button onClick={() => handleScreenshot(exportId, code)} className="btn-primary flex-1 py-3 text-sm">
                                        <IconRenderer icon={Icons.Download} />
                                        <span>ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©</span>
                                    </button>
                                    <div className="flex gap-1">
                                        <button onClick={() => onMove(code, -1)} className="w-12 h-12 rounded-xl bg-gray-100 dark:bg-slate-800 text-gray-500 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors"><IconRenderer icon={Icons.ArrowUp} /></button>
                                        <button onClick={() => onMove(code, 1)} className="w-12 h-12 rounded-xl bg-gray-100 dark:bg-slate-800 text-gray-500 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors"><IconRenderer icon={Icons.ArrowDown} /></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Gold Modal ---
        const GoldDetailModal = ({ gold, onClose, onMove, time }) => {
            if (!gold) return null;
            const sell = parseFloat(gold.sell_price);
            const buy = parseFloat(gold.buy_price);
            const spread = sell - buy;
            const chartData = useMemo(() => generateChartData(sell, 15, 0.015), [sell]);
            const goldKey = gold.description;

            const isOunce = gold.description.includes('ÿ£ŸàŸÜÿµÿ©') || gold.description.includes('Ounce');
            const displayCode = isOunce ? 'OZ' : (gold.description.match(/\d+/) ? `K${gold.description.match(/\d+/)[0]}` : 'GOLD');
            const displayIcon = isOunce ? '‚öñÔ∏è' : 'üèÜ';
            const currencySymbol = isOunce ? "$" : "ŸÑ.ÿ≥";
            const exportId = `export-gold-${displayCode}`;

            return (
                <div className="fixed inset-0 z-[70] flex items-end sm:items-center justify-center bg-brand-dark/40 dark:bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-300" onClick={onClose}>
                    <PromoExportCard id={exportId} title={gold.description} subTitle={isOunce ? "ÿ≥ÿπÿ± ÿßŸÑÿ£ŸàŸÜÿµÿ© ÿßŸÑÿπÿßŸÑŸÖŸäÿ©" : "ÿ≥ÿπÿ± ÿ∫ÿ±ÿßŸÖ ÿßŸÑÿ∞Ÿáÿ® ŸÅŸä ÿ≥Ÿàÿ±Ÿäÿß"} icon={displayIcon} code={displayCode} sell={sell} buy={buy} time={time} isUsd={isOunce} isGold={true} />

                    <div className="app-card w-full max-w-sm p-0 overflow-hidden animate-in zoom-in-95 slide-in-from-bottom-10 duration-300 relative" onClick={e => e.stopPropagation()}>
                        <div className="p-6">
                            <div className="flex justify-between items-start mb-6">
                                <div className="flex items-center gap-4">
                                    <div className="w-14 h-14 rounded-2xl bg-yellow-50 dark:bg-yellow-900/20 flex items-center justify-center text-3xl shadow-sm border border-yellow-100 dark:border-yellow-900/30">
                                        {displayIcon}
                                    </div>
                                    <div>
                                        <h2 className="text-xl font-black text-gray-800 dark:text-white leading-tight">{gold.description}</h2>
                                        <div className="flex items-center gap-2 mt-1">
                                            <span className="text-[10px] font-bold text-yellow-600 dark:text-yellow-400 uppercase tracking-widest">{displayCode}</span>
                                            <span className="text-[10px] text-gray-400 font-bold uppercase tracking-tight">Market Update</span>
                                        </div>
                                    </div>
                                </div>
                                <ElegantCloseButton onClick={onClose} />
                            </div>

                            <div className="grid grid-cols-2 gap-4 mb-6">
                                <div className="bg-gray-50 dark:bg-slate-800/50 rounded-2xl p-4 border border-gray-100 dark:border-slate-700">
                                    <span className="text-[10px] text-gray-400 font-bold mb-1 block">ÿ≥ÿπÿ± ÿßŸÑŸÖÿ®Ÿäÿπ</span>
                                    <span className="text-2xl font-black num-en text-gray-800 dark:text-white">
                                        {isOunce ? '$ ' : ''}{sell.toLocaleString('en-US')}
                                    </span>
                                </div>
                                <div className="bg-yellow-50 dark:bg-yellow-900/10 rounded-2xl p-4 border border-yellow-100 dark:border-yellow-900/20">
                                    <span className="text-[10px] text-yellow-700 dark:text-yellow-500 font-bold mb-1 block">ÿ≥ÿπÿ± ÿßŸÑÿ¥ÿ±ÿßÿ°</span>
                                    <span className="text-2xl font-black num-en text-yellow-600 dark:text-yellow-400">
                                        {isOunce ? '$ ' : ''}{buy.toLocaleString('en-US')}
                                    </span>
                                </div>
                            </div>

                            <div className="mb-6">
                                <LineChart data={chartData} color="#eab308" height={100} showAxis={false} />
                            </div>

                            <div className="space-y-4">
                                <div className="flex justify-between items-center bg-gray-50 dark:bg-slate-800/40 rounded-xl px-4 py-3 border border-gray-100 dark:border-slate-700">
                                    <div className="text-center flex-1">
                                        <span className="block text-[9px] text-gray-400 font-bold uppercase">ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´</span>
                                        <span className="block text-xs font-bold num-en text-gray-700 dark:text-gray-200">{formatLastUpdate(time)}</span>
                                    </div>
                                    <div className="w-px h-6 bg-yellow-200 dark:bg-yellow-900/30"></div>
                                    <div className="text-center flex-1">
                                        <span className="block text-[9px] text-gray-400 font-bold uppercase">ŸÅÿßÿ±ŸÇ ÿßŸÑÿµŸäÿßÿ∫ÿ©</span>
                                        <span className="block text-xs font-bold num-en text-gray-700 dark:text-gray-200">{spread.toLocaleString('en-US')} {currencySymbol}</span>
                                    </div>
                                </div>

                                <div className="flex gap-3">
                                    <button onClick={() => handleScreenshot(exportId, gold.description)} className="flex-1 btn-primary bg-yellow-600 hover:bg-yellow-700 py-3 text-sm">
                                        <IconRenderer icon={Icons.Download} />
                                        <span>ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©</span>
                                    </button>
                                    <div className="flex gap-1">
                                        <button onClick={() => onMove(goldKey, -1)} className="w-12 h-12 rounded-xl bg-gray-100 dark:bg-slate-800 text-gray-500 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors"><IconRenderer icon={Icons.ArrowUp} /></button>
                                        <button onClick={() => onMove(goldKey, 1)} className="w-12 h-12 rounded-xl bg-gray-100 dark:bg-slate-800 text-gray-500 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors"><IconRenderer icon={Icons.ArrowDown} /></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // *** REDESIGNED RATE CARD (With Glow Effect) ***
        const RateCard = ({ title, buy, sell, icon, code, stats, onClick, draggable, onDragStart, onDragEnter, onDragEnd, isUsd = false }) => {
            const isUp = stats?.direction === 'up';
            const isDown = stats?.direction === 'down';

            return (
                <div
                    onClick={onClick}
                    draggable={draggable}
                    onDragStart={onDragStart}
                    onDragEnter={onDragEnter}
                    onDragEnd={onDragEnd}
                    onDragOver={(e) => e.preventDefault()}
                    className="app-card overflow-hidden cursor-pointer hover:border-brand-primary/30 active:scale-[0.98] transition-all duration-200"
                >
                    <div className="p-4">
                        <div className="flex justify-between items-start mb-4">
                            <div className="flex items-center gap-3">
                                <div className="w-12 h-12 rounded-xl bg-gray-50 dark:bg-slate-800 flex items-center justify-center text-2xl shadow-sm border border-gray-100 dark:border-slate-700 relative">
                                    {icon}
                                    {stats && stats.direction !== 'neutral' && (
                                        <div className={`absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 border-white dark:border-slate-900 flex items-center justify-center text-[8px] font-bold ${isUp ? 'bg-emerald-500 text-white' : 'bg-rose-500 text-white'}`}>
                                            {isUp ? '‚Üë' : '‚Üì'}
                                        </div>
                                    )}
                                </div>
                                <div>
                                    <h3 className="font-bold text-gray-800 dark:text-white text-sm leading-tight line-clamp-1">{title}</h3>
                                    <span className="text-[10px] text-gray-400 font-bold uppercase tracking-wider">{code}</span>
                                </div>
                            </div>
                            {stats && (
                                <div className={`px-2 py-0.5 rounded-lg flex items-center gap-1 ${isUp ? 'bg-emerald-50 text-emerald-600 dark:bg-emerald-900/20 dark:text-emerald-400' : 'bg-rose-50 text-rose-600 dark:bg-rose-900/20 dark:text-rose-400'}`}>
                                    <span className="text-[10px] font-bold num-en">{stats.percent}%</span>
                                </div>
                            )}
                        </div>

                        <div className="grid grid-cols-2 gap-3">
                            <div className="flex flex-col">
                                <span className="text-[9px] text-gray-400 font-bold uppercase mb-0.5">ŸÖÿ®Ÿäÿπ</span>
                                <span className={`text-lg font-black num-en tracking-tight ${isDown ? 'text-rose-500' : 'text-gray-800 dark:text-white'}`}>
                                    {isUsd ? '$ ' : ''}{parseFloat(sell).toLocaleString('en-US')}
                                </span>
                            </div>
                            <div className="flex flex-col text-right">
                                <span className="text-[9px] text-gray-400 font-bold uppercase mb-0.5">ÿ¥ÿ±ÿßÿ°</span>
                                <span className={`text-lg font-black num-en tracking-tight ${isUp ? 'text-emerald-500' : 'text-brand-primary'}`}>
                                    {isUsd ? '$ ' : ''}{parseFloat(buy).toLocaleString('en-US')}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Energy Modal ---
        const EnergyDetailModal = ({ energy, onClose, onMove, time }) => {
            if (!energy) return null;
            const sell = parseFloat(energy.priceUSD);
            const buy = parseFloat(energy.priceSYP);
            const isUp = energy.stats?.direction === 'up';
            const chartData = useMemo(() => generateChartData(buy, 15, 0.01), [buy]);
            const code = energy.title.includes('ÿ®ŸÜÿ≤ŸäŸÜ') ? 'PETROL' : 'DIESEL';
            const exportId = `export-energy-${code}`;

            return (
                <div className="fixed inset-0 z-[70] flex items-end sm:items-center justify-center bg-brand-dark/40 dark:bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-300" onClick={onClose}>
                    <PromoExportCard id={exportId} title={energy.title} subTitle="ŸÜÿ¥ÿ±ÿ© ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑŸÖÿ≠ÿ±ŸàŸÇÿßÿ™" icon={energy.icon} code={code} sell={sell} buy={buy} time={time} isUsd={false} isGold={false} sellLabel="ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿπÿßŸÑŸÖŸä ($)" buyLabel="ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÖÿ≠ŸÑŸä (ŸÑ.ÿ≥)" sellPrefix="$" />

                    <div className="app-card w-full max-w-sm p-0 overflow-hidden animate-in zoom-in-95 slide-in-from-bottom-10 duration-300 relative" onClick={e => e.stopPropagation()}>
                        <div className="p-6">
                            <div className="flex justify-between items-start mb-6">
                                <div className="flex items-center gap-4">
                                    <div className={`w-14 h-14 rounded-2xl bg-gray-50 dark:bg-slate-800 flex items-center justify-center text-3xl shadow-sm border border-gray-100 dark:border-slate-700 ${energy.iconColor}`}>
                                        {energy.icon}
                                    </div>
                                    <div>
                                        <h2 className="text-xl font-black text-gray-800 dark:text-white leading-tight">{energy.title}</h2>
                                        <div className="flex items-center gap-2 mt-1">
                                            <span className="text-[10px] font-bold text-gray-400 uppercase tracking-widest">{code}</span>
                                            {energy.stats && energy.stats.direction !== 'neutral' && (
                                                <span className={`text-[10px] font-bold px-2 py-0.5 rounded-md ${isUp ? 'bg-emerald-100 text-emerald-700 dark:bg-emerald-900/40 dark:text-emerald-400' : 'bg-rose-100 text-rose-700 dark:bg-rose-900/40 dark:text-rose-400'}`}>
                                                    {isUp ? '‚Üë' : '‚Üì'} {energy.stats.percent}% (USD)
                                                </span>
                                            )}
                                        </div>
                                    </div>
                                </div>
                                <ElegantCloseButton onClick={onClose} />
                            </div>

                            <div className="grid grid-cols-2 gap-4 mb-6">
                                <div className="bg-gray-50 dark:bg-slate-800/50 rounded-2xl p-4 border border-gray-100 dark:border-slate-700">
                                    <span className="text-[10px] text-gray-400 font-bold mb-1 block">ÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿπÿßŸÑŸÖŸä</span>
                                    <span className="text-2xl font-black num-en text-gray-800 dark:text-white">$ {sell}</span>
                                </div>
                                <div className="bg-brand-primary/5 dark:bg-brand-primary/10 rounded-2xl p-4 border border-brand-primary/20">
                                    <span className="text-[10px] text-brand-primary font-bold mb-1 block">ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÖÿ≠ŸÑŸä</span>
                                    <span className="text-2xl font-black num-en text-brand-primary">{buy.toLocaleString('en-US')}</span>
                                </div>
                            </div>

                            <div className="mb-6">
                                <LineChart data={chartData} color={isUp ? "#10b981" : "#ef4444"} height={100} showAxis={false} />
                            </div>

                            <div className="space-y-4">
                                <div className="flex justify-between items-center bg-gray-50 dark:bg-slate-800/40 rounded-xl px-4 py-3 border border-gray-100 dark:border-slate-700">
                                    <div className="text-center w-full">
                                        <span className="block text-[9px] text-gray-400 font-bold uppercase">ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´</span>
                                        <span className="block text-xs font-bold num-en text-gray-700 dark:text-gray-200">{formatLastUpdate(time)}</span>
                                    </div>
                                </div>

                                <div className="flex gap-3">
                                    <button onClick={() => handleScreenshot(exportId, code)} className="btn-primary flex-1 py-3 text-sm">
                                        <IconRenderer icon={Icons.Download} />
                                        <span>ÿ≠ŸÅÿ∏ ÿßŸÑÿ®ÿ∑ÿßŸÇÿ©</span>
                                    </button>
                                    <div className="flex gap-1">
                                        <button onClick={() => onMove(energy.id, -1)} className="w-12 h-12 rounded-xl bg-gray-100 dark:bg-slate-800 text-gray-500 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors"><IconRenderer icon={Icons.ArrowUp} /></button>
                                        <button onClick={() => onMove(energy.id, 1)} className="w-12 h-12 rounded-xl bg-gray-100 dark:bg-slate-800 text-gray-500 flex items-center justify-center hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors"><IconRenderer icon={Icons.ArrowDown} /></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };


        // --- Energy Card ---
        const EnergyCard = ({ title, priceUSD, priceSYP, icon, iconColor, stats, onClick, draggable, onDragStart, onDragEnter, onDragEnd }) => {
            const isUp = stats?.direction === 'up';
            const isDown = stats?.direction === 'down';

            return (
                <div
                    onClick={onClick}
                    draggable={draggable}
                    onDragStart={onDragStart}
                    onDragEnter={onDragEnter}
                    onDragEnd={onDragEnd}
                    onDragOver={(e) => e.preventDefault()}
                    className="app-card overflow-hidden cursor-pointer hover:border-brand-primary/30 active:scale-[0.98] transition-all duration-200"
                >
                    <div className="p-4">
                        <div className="flex justify-between items-start mb-4">
                            <div className="flex items-center gap-3">
                                <div className={`w-12 h-12 rounded-xl bg-gray-50 dark:bg-slate-800 flex items-center justify-center text-2xl shadow-sm border border-gray-100 dark:border-slate-700 relative ${iconColor}`}>
                                    {icon}
                                    {stats && stats.direction !== 'neutral' && (
                                        <div className={`absolute -top-1 -right-1 w-4 h-4 rounded-full border-2 border-white dark:border-slate-900 flex items-center justify-center text-[8px] font-bold ${isUp ? 'bg-emerald-500 text-white' : 'bg-rose-500 text-white'}`}>
                                            {isUp ? '‚Üë' : '‚Üì'}
                                        </div>
                                    )}
                                </div>
                                <div>
                                    <h3 className="font-bold text-gray-800 dark:text-white text-sm leading-tight line-clamp-1">{title}</h3>
                                    <span className="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Energy Unit</span>
                                </div>
                            </div>
                            {stats && (
                                <div className={`px-2 py-0.5 rounded-lg flex items-center gap-1 ${isUp ? 'bg-emerald-50 text-emerald-600 dark:bg-emerald-900/20 dark:text-emerald-400' : 'bg-rose-50 text-rose-600 dark:bg-rose-900/20 dark:text-rose-400'}`}>
                                    <span className="text-[10px] font-bold num-en">{stats.percent}%</span>
                                </div>
                            )}
                        </div>

                        <div className="grid grid-cols-2 gap-3">
                            <div className="flex flex-col">
                                <span className="text-[9px] text-gray-400 font-bold uppercase mb-0.5">USD Price</span>
                                <span className="text-lg font-black num-en tracking-tight text-gray-800 dark:text-white">${priceUSD}</span>
                            </div>
                            <div className="flex flex-col text-right">
                                <span className="text-[9px] text-gray-400 font-bold uppercase mb-0.5">SYP Equivalent</span>
                                <span className={`text-lg font-black num-en tracking-tight ${isUp ? 'text-emerald-500' : 'text-brand-primary'}`}>{parseFloat(priceSYP).toLocaleString('en-US')}</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const InstallPrompt = () => {
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [showBanner, setShowBanner] = useState(false);
            useEffect(() => {
                const handler = (e) => { e.preventDefault(); setDeferredPrompt(e); setShowBanner(true); };
                window.addEventListener('beforeinstallprompt', handler);
                return () => window.removeEventListener('beforeinstallprompt', handler);
            }, []);
            const handleInstallClick = () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((res) => { setDeferredPrompt(null); setShowBanner(false); });
                }
            };
            if (!showBanner) return null;
            return (
                <div className="fixed top-0 left-0 right-0 z-[60] p-4 install-banner">
                    <div className="bg-brand-dark text-white rounded-2xl shadow-2xl p-4 flex items-center justify-between border border-brand-primary/30">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-brand-primary rounded-xl flex items-center justify-center font-bold text-brand-dark">24</div>
                            <div><h3 className="font-bold text-sm">ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÑŸäÿ±ÿ© 24</h3><p className="text-xs text-brand-light opacity-80">ÿ™ÿ´ÿ®Ÿäÿ™ ŸÑŸÑŸàÿµŸàŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπ</p></div>
                        </div>
                        <div className="flex items-center gap-2">
                            <button onClick={() => setShowBanner(false)} className="p-2 text-gray-400 hover:text-white"><IconRenderer icon={Icons.X} /></button>
                            <button onClick={handleInstallClick} className="bg-brand-primary text-brand-dark px-4 py-2 rounded-xl text-xs font-bold hover:bg-white transition flex items-center gap-2"><IconRenderer icon={Icons.Download} /> ÿ™ÿ´ÿ®Ÿäÿ™</button>
                        </div>
                    </div>
                </div>
            );
        };

        const SplashScreen = () => (
            <div className="fixed inset-0 z-[100] flex flex-col items-center justify-center bg-white dark:bg-slate-950 overflow-hidden">
                <div className="relative z-10 flex flex-col items-center animate-in fade-in zoom-in duration-700">
                    <div className="relative w-24 h-24 mb-6 flex items-center justify-center">
                        <div className="absolute inset-0 bg-brand-primary/20 rounded-[2rem] blur-xl animate-pulse"></div>
                        <div className="relative w-full h-full bg-brand-dark dark:bg-slate-900 rounded-[1.5rem] flex items-center justify-center shadow-xl border border-brand-primary/20">
                            <span className="text-brand-primary font-black text-4xl">24</span>
                        </div>
                    </div>
                    <h1 className="text-3xl font-black text-gray-800 dark:text-white mb-1">ÿßŸÑŸÑŸäÿ±ÿ© <span className="text-brand-primary">24</span></h1>
                    <p className="text-gray-400 text-xs font-bold tracking-widest opacity-80 mb-8 uppercase">Markets & Exchange</p>
                    <div className="w-40 h-1 bg-gray-100 dark:bg-slate-800 rounded-full overflow-hidden">
                        <div className="h-full bg-brand-primary w-full animate-[loading_1.5s_ease-in-out] origin-right"></div>
                    </div>
                </div>
            </div>
        );

        // --- Featured Rate Card (New) ---
        // --- Featured Rate Card (New - ENHANCED) ---
        const FeaturedRateCard = () => null;

        // --- Main App ---
        const NavBar = ({ activeTab, setActiveTab }) => (
            <div className="fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-slate-900 border-t border-gray-100 dark:border-slate-800 px-6 pb-6 pt-3 shadow-[0_-10px_20px_rgba(0,0,0,0.02)]">
                <div className="flex justify-between items-center max-w-lg mx-auto">
                    {[
                        { id: 'home', icon: Icons.Home, label: 'ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©' },
                        { id: 'calc', icon: Icons.Calculator, label: 'ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿ©' },
                        { id: 'transfer', icon: Icons.Send, label: 'ÿ™ÿ≠ŸàŸäŸÑ', primary: true },
                        { id: 'gold', icon: Icons.Coins, label: 'ÿßŸÑÿ∞Ÿáÿ®' },
                        { id: 'global', icon: Icons.Globe, label: 'ÿπÿßŸÑŸÖŸä' }
                    ].map((tab) => (
                        <button
                            key={tab.id}
                            onClick={() => setActiveTab(tab.id)}
                            className={`flex flex-col items-center gap-1 transition-all ${tab.primary ? 'relative -top-8' : ''}`}
                        >
                            {tab.primary ? (
                                <div className={`w-14 h-14 rounded-2xl flex items-center justify-center shadow-lg transition-all ${activeTab === tab.id ? 'bg-brand-primary text-brand-dark scale-110 shadow-brand-primary/25' : 'bg-brand-dark dark:bg-slate-800 text-white'}`}>
                                    <IconRenderer icon={tab.icon} />
                                </div>
                            ) : (
                                <>
                                    <div className={`transition-colors ${activeTab === tab.id ? 'text-brand-primary' : 'text-gray-400'}`}>
                                        <IconRenderer icon={tab.icon} />
                                    </div>
                                    <span className={`text-[9px] font-bold ${activeTab === tab.id ? 'text-brand-primary' : 'text-gray-400'}`}>{tab.label}</span>
                                </>
                            )}
                        </button>
                    ))}
                </div>
            </div>
        );

        const Header = ({ title, subtitle, time, showDate = true, showBack = false, onBack, setActiveTab, loadData }) => (
            <div className="mb-6">
                <div className="flex justify-between items-center mb-4">
                    <div className="flex items-center gap-3">
                        {showBack ? (
                            <button onClick={onBack} className="w-10 h-10 rounded-xl bg-gray-100 dark:bg-slate-800 flex items-center justify-center text-gray-800 dark:text-white hover:bg-gray-200 transition-colors">
                                <IconRenderer icon={Icons.ArrowLeft} />
                            </button>
                        ) : (
                            <div className="w-10 h-10 bg-brand-dark dark:bg-slate-800 rounded-xl flex items-center justify-center text-brand-primary shadow-sm">
                                <span className="font-black text-xs">24</span>
                            </div>
                        )}
                        <div>
                            <h1 className="text-lg font-black text-gray-800 dark:text-white leading-tight">{title}</h1>
                            <p className="text-[10px] text-gray-400 font-bold uppercase tracking-widest">{subtitle}</p>
                        </div>
                    </div>

                    {!showBack && (
                        <div className="flex items-center gap-2">
                            <button onClick={() => setActiveTab('settings')} className="w-10 h-10 rounded-xl bg-gray-50 dark:bg-slate-800 flex items-center justify-center text-gray-400 dark:text-gray-500 hover:text-brand-primary transition-colors">
                                <IconRenderer icon={Icons.Settings} />
                            </button>
                            <button onClick={loadData} className="w-10 h-10 rounded-xl bg-brand-primary flex items-center justify-center text-brand-dark shadow-sm hover:scale-105 transition-transform active:scale-95">
                                <IconRenderer icon={Icons.Refresh} />
                            </button>
                        </div>
                    )}
                </div>

                {showDate && time && (
                    <div className="flex items-center gap-2 text-[10px] text-gray-400 font-bold bg-white dark:bg-slate-900 border border-gray-100 dark:border-slate-800 py-1.5 px-3 rounded-lg w-fit">
                        <span className="w-1.5 h-1.5 bg-brand-primary rounded-full animate-pulse"></span>
                        <span className="num-en">{formatDateForExport(time)} | {formatLastUpdate(time)}</span>
                    </div>
                )}
            </div>
        );

        const timeframeMapping = {
            '1D': { points: 24, volatility: 0.01 },
            '1W': { points: 7, volatility: 0.015 },
            '1M': { points: 30, volatility: 0.03 },
            '1Y': { points: 12, volatility: 0.10 }
        };

        const calculateValue = (amount, source, direction, mode) => {
            if (!source || !amount) return 0;
            const price = parseFloat(source[mode === 'sell' ? 'sell_price' : 'buy_price']);
            if (direction === 'to_syp') return amount * price;
            return amount / price;
        };

        const getChartData = (source, timeframe, mode) => {
            if (!source || !timeframe) return generateChartData(0, 24, 0.01);
            const base = parseFloat(source[mode === 'sell' ? 'sell_price' : 'buy_price']);
            return generateChartData(base, timeframe.points, timeframe.volatility);
        };

        function App() {
            const [showSplash, setShowSplash] = useState(true);
            const [activeTab, setActiveTab] = useState('home');
            const [currencyData, setCurrencyData] = useState([]);
            const [globalRawData, setGlobalRawData] = useState(null);
            const [baseCurrency, setBaseCurrency] = useState('USD');
            const [convAmount, setConvAmount] = useState(100);
            const [convFrom, setConvFrom] = useState('USD');
            const [convTo, setConvTo] = useState('EUR');
            const [goldData, setGoldData] = useState([]);
            const [loading, setLoading] = useState(true);
            const [globalLoading, setGlobalLoading] = useState(false);

            // --- Theme Logic ---
            const getInitialThemePreference = () => localStorage.getItem('themePreference') || 'system';
            const isSystemDark = () => window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

            const getEffectiveDarkMode = (pref) => {
                if (pref === 'dark') return true;
                if (pref === 'light') return false;
                return isSystemDark();
            };

            const [themePreference, setThemePreference] = useState(getInitialThemePreference);
            const [darkMode, setDarkMode] = useState(() => getEffectiveDarkMode(getInitialThemePreference()));

            useEffect(() => {
                localStorage.setItem('themePreference', themePreference);
                let effectiveDark = getEffectiveDarkMode(themePreference);
                if (effectiveDark) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
                setDarkMode(effectiveDark);
            }, [themePreference]);

            useEffect(() => {
                const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
                const handler = (e) => {
                    if (themePreference === 'system') {
                        const effectiveDark = e.matches;
                        if (effectiveDark) {
                            document.documentElement.classList.add('dark');
                        } else {
                            document.documentElement.classList.remove('dark');
                        }
                        setDarkMode(effectiveDark);
                    }
                };
                mediaQuery.addEventListener('change', handler);
                return () => mediaQuery.removeEventListener('change', handler);
            }, [themePreference]);

            const [goldCalcWeight, setGoldCalcWeight] = useState('');
            const [goldCalcFee, setGoldCalcFee] = useState('');
            const [goldCalcMode, setGoldCalcMode] = useState('sell');
            const [selectedGoldId, setSelectedGoldId] = useState(null);
            const [dbLastUpdate, setDbLastUpdate] = useState(new Date());
            const [apiLastUpdate, setApiLastUpdate] = useState(new Date());
            const [showGold, setShowGold] = useState(() => { return localStorage.getItem('showGoldOnHome') !== 'false'; });
            const [showEnergy, setShowEnergy] = useState(() => { return localStorage.getItem('showEnergyOnHome') !== 'false'; });
            const [calcAmount, setCalcAmount] = useState(100);
            const [calcSource, setCalcSource] = useState(null);
            const [calcMode, setCalcMode] = useState('buy');
            const [chartTimeframe, setChartTimeframe] = useState('1D');
            const [calcDirection, setCalcDirection] = useState('to_syp');
            const [chartData, setChartData] = useState([]);

            const [isCustomizeOpen, setIsCustomizeOpen] = useState(false);

            const [pinned, setPinned] = useState(() => { try { return JSON.parse(localStorage.getItem('pinnedCurrencies')) || ['USD', 'EUR', 'TRY', 'SAR']; } catch { return ['USD', 'EUR', 'TRY', 'SAR']; } });
            const [selectedCurrency, setSelectedCurrency] = useState(null);

            const [goldOrder, setGoldOrder] = useState(() => { try { return JSON.parse(localStorage.getItem('goldOrder')) || []; } catch { return []; } });

            const [pinnedGold, setPinnedGold] = useState(() => { try { return JSON.parse(localStorage.getItem('pinnedGold')) || []; } catch { return []; } });

            const [energyOrder, setEnergyOrder] = useState(() => {
                try {
                    const stored = JSON.parse(localStorage.getItem('energyOrder'));
                    return stored || ['benzene', 'diesel']; // Default order: Benzene first, then Diesel
                } catch {
                    return ['benzene', 'diesel'];
                }
            });

            const [globalOrder, setGlobalOrder] = useState(() => {
                try {
                    const stored = JSON.parse(localStorage.getItem('globalOrder'));
                    return stored || Object.keys(GLOBAL_DISPLAY_MAP);
                } catch {
                    return Object.keys(GLOBAL_DISPLAY_MAP);
                }
            });

            const [selectedGoldCard, setSelectedGoldCard] = useState(null);
            const [selectedEnergy, setSelectedEnergy] = useState(null);
            const [transferService, setTransferService] = useState('global');
            // --- Transfer Center State ---
            const [transferAmount, setTransferAmount] = useState('');
            const [transferDirection, setTransferDirection] = useState('USDT_SYP'); // enum: USDT_SYP, SYP_USDT
            const [transferFeeType, setTransferFeeType] = useState('add'); // enum: deduct, add
            const [transferStep, setTransferStep] = useState(1); // 1: Calc, 2: Wallet, 3: Form
            const [transferForm, setTransferForm] = useState({ city: '', name: '', mobile: '', notes: '' });
            const [transferReceiveCurrency, setTransferReceiveCurrency] = useState('SYP'); // New: SYP or USD

            const dragItem = useRef();
            const dragOverItem = useRef();

            useEffect(() => { setTimeout(() => setShowSplash(false), 3000); }, []);
            useEffect(() => { localStorage.setItem('pinnedCurrencies', JSON.stringify(pinned)); }, [pinned]);
            useEffect(() => { localStorage.setItem('goldOrder', JSON.stringify(goldOrder)); }, [goldOrder]);
            useEffect(() => { localStorage.setItem('showGoldOnHome', showGold); }, [showGold]);
            useEffect(() => { localStorage.setItem('showEnergyOnHome', showEnergy); }, [showEnergy]);
            useEffect(() => { localStorage.setItem('pinnedGold', JSON.stringify(pinnedGold)); }, [pinnedGold]);
            useEffect(() => { localStorage.setItem('energyOrder', JSON.stringify(energyOrder)); }, [energyOrder]);
            useEffect(() => { localStorage.setItem('globalOrder', JSON.stringify(globalOrder)); }, [globalOrder]);

            useEffect(() => {
                loadData();
                const handleVisibilityChange = () => {
                    if (document.visibilityState === 'visible') {
                        loadData();
                    }
                };
                document.addEventListener("visibilitychange", handleVisibilityChange);
                return () => {
                    document.removeEventListener("visibilitychange", handleVisibilityChange);
                };
            }, []);
            useEffect(() => { if (goldData.length > 0 && !selectedGoldId) setSelectedGoldId(goldData[0].id || goldData[0].description); }, [goldData]);

            useEffect(() => {
                if (goldData.length > 0 && pinnedGold.length === 0) {
                    setPinnedGold(goldData.slice(0, 2).map(g => g.description));
                }
            }, [goldData]);

            useEffect(() => {
                if (calcSource) {
                    const base = parseFloat(calcSource[calcMode === 'sell' ? 'sell_price' : 'buy_price']);
                    let points = 24, volatility = 0.01;
                    if (chartTimeframe === '1W') { points = 7; volatility = 0.015; } else if (chartTimeframe === '1M') { points = 30; volatility = 0.03; } else if (chartTimeframe === '1Y') { points = 12; volatility = 0.10; }
                    setChartData(generateChartData(base, points, volatility));
                }
            }, [calcSource, chartTimeframe, calcMode]);
            useEffect(() => { if (activeTab === 'global') fetchGlobalRates(); }, [activeTab]);

            const loadData = async () => {
                setLoading(true);
                // ÿ¨ŸÑÿ® ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖŸÜ ÿßŸÑŸÄ Views
                const [currencies, gold] = await Promise.all([
                    fetchSupabaseData("currency_rates_api"),
                    fetchSupabaseData("gold_rates_api")
                ]);

                // --- ÿ®ÿØÿßŸäÿ© ÿßŸÑÿ™ÿπÿØŸäŸÑ: ÿ≠ÿ≥ÿßÿ® ÿ¢ÿÆÿ± ŸàŸÇÿ™ ÿ™ÿ≠ÿØŸäÿ´ ÿ≠ŸÇŸäŸÇŸä ---
                const allItems = [...currencies, ...gold];
                let latestTime = new Date(); // ŸÇŸäŸÖÿ© ÿßŸÅÿ™ÿ±ÿßÿ∂Ÿäÿ©

                if (allItems.length > 0) {
                    // ŸÜÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£ÿ≠ÿØÿ´ ÿ™ÿßÿ±ŸäÿÆ ŸÅŸä ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™
                    const timestamps = allItems
                        .map(item => item.updated_at ? new Date(item.updated_at) : null)
                        .filter(date => date !== null && !isNaN(date));

                    if (timestamps.length > 0) {
                        latestTime = new Date(Math.max(...timestamps));
                    }
                }
                setDbLastUpdate(latestTime);
                // --- ŸÜŸáÿßŸäÿ© ÿßŸÑÿ™ÿπÿØŸäŸÑ ---

                const enrichedCurrencies = currencies.map(c => {
                    const { code } = getFlagAndCode(c.name);
                    const stats = calculateChange(c.sell_price, c.previous_sell_price);
                    return { ...c, stats, code };
                });

                const enrichedGold = gold.map(g => {
                    const stats = calculateChange(g.sell_price, g.previous_sell_price);
                    return { ...g, stats };
                });

                setCurrencyData(enrichedCurrencies);
                setGoldData(enrichedGold);

                setGoldOrder(prevOrder => {
                    const currentDescriptions = enrichedGold.map(g => g.description);
                    let validOrder = prevOrder.filter(d => currentDescriptions.includes(d));
                    const newItems = currentDescriptions.filter(d => !validOrder.includes(d));
                    const ounceItem = newItems.find(d => d.includes('ÿ£ŸàŸÜÿµÿ©') || d.includes('Ounce'));
                    const otherNewItems = newItems.filter(d => d !== ounceItem);
                    let finalOrder = [...validOrder];
                    if (ounceItem) finalOrder.unshift(ounceItem);
                    finalOrder = [...finalOrder, ...otherNewItems];
                    return finalOrder;
                });

                const defaultCalcGold = enrichedGold.find(g => !g.description.includes('ÿ£ŸàŸÜÿµÿ©') && !g.description.includes('Ounce'));
                if (defaultCalcGold) {
                    setCalcSource(enrichedCurrencies.find(c => c.name.includes("ÿØŸàŸÑÿßÿ±")));
                    if (!selectedGoldId) setSelectedGoldId(defaultCalcGold.id || defaultCalcGold.description);
                }

                setLoading(false);
                if (window.lucide) setTimeout(() => window.lucide.createIcons(), 100);
            };

            const fetchGlobalRates = async () => {
                const now = Date.now();
                const cachedGlobal = localStorage.getItem('globalRatesRaw');
                const lastGlobalFetch = localStorage.getItem('globalRatesTime');
                if (cachedGlobal && lastGlobalFetch && (now - parseInt(lastGlobalFetch) < GLOBAL_CACHE_DURATION)) {
                    setGlobalRawData(JSON.parse(cachedGlobal));
                    return;
                }
                setGlobalLoading(true);
                try {
                    const res = await fetch(`https://api.currencyapi.com/v3/latest?apikey=${CURRENCY_API_KEY}&base_currency=USD`);
                    const result = await res.json();
                    if (result.data) {
                        setGlobalRawData(result.data);
                        localStorage.setItem('globalRatesRaw', JSON.stringify(result.data));
                        localStorage.setItem('globalRatesTime', now.toString());
                        setApiLastUpdate(new Date());
                    }
                } catch (error) { console.error("Error global rates", error); }
                setGlobalLoading(false);
            };

            const handleSort = () => {
                let _pinned = [...pinned];
                const draggedItemContent = _pinned.splice(dragItem.current, 1)[0];
                _pinned.splice(dragOverItem.current, 0, draggedItemContent);
                dragItem.current = null;
                dragOverItem.current = null;
                setPinned(_pinned);
            };
            const handleMoveCard = (code, direction) => {
                const idx = pinned.indexOf(code);
                if (idx === -1) return;
                const newIdx = idx + direction;
                if (newIdx < 0 || newIdx >= pinned.length) return;
                const newPinned = [...pinned];
                [newPinned[idx], newPinned[newIdx]] = [newPinned[newIdx], newPinned[idx]];
                setPinned(newPinned);
            };

            const handleGoldSort = () => {
                let _order = [...goldOrder];
                const draggedItemContent = _order.splice(dragItem.current, 1)[0];
                _order.splice(dragOverItem.current, 0, draggedItemContent);
                dragItem.current = null;
                dragOverItem.current = null;
                setGoldOrder(_order);
            };
            const handleMoveGold = (desc, direction) => {
                const idx = goldOrder.indexOf(desc);
                if (idx === -1) return;
                const newIdx = idx + direction;
                if (newIdx < 0 || newIdx >= goldOrder.length) return;
                const newOrder = [...goldOrder];
                [newOrder[idx], newOrder[newIdx]] = [newOrder[newIdx], newOrder[idx]];
                setGoldOrder(newOrder);
            };

            const handlePinnedGoldSort = () => {
                let _pinned = [...pinnedGold];
                const draggedItemContent = _pinned.splice(dragItem.current, 1)[0];
                _pinned.splice(dragOverItem.current, 0, draggedItemContent);
                dragItem.current = null;
                dragOverItem.current = null;
                setPinnedGold(_pinned);
            };

            const handleEnergySort = () => {
                let _order = [...energyOrder];
                const draggedItemContent = _order.splice(dragItem.current, 1)[0];
                _order.splice(dragOverItem.current, 0, draggedItemContent);
                dragItem.current = null;
                dragOverItem.current = null;
                setEnergyOrder(_order);
            };

            const handleMoveEnergy = (energyId, direction) => {
                const idx = energyOrder.indexOf(energyId);
                if (idx === -1) return;
                const newIdx = idx + direction;
                if (newIdx < 0 || newIdx >= energyOrder.length) return;
                const newOrder = [...energyOrder];
                [newOrder[idx], newOrder[newIdx]] = [newOrder[newIdx], newOrder[idx]];
                setEnergyOrder(newOrder);
            };

            const handleGlobalSort = () => {
                const visibleItems = globalOrder.filter(k => k !== baseCurrency);
                let _visibleList = [...visibleItems];
                const draggedItemContent = _visibleList.splice(dragItem.current, 1)[0];
                _visibleList.splice(dragOverItem.current, 0, draggedItemContent);
                const newGlobalOrder = [..._visibleList];
                if (!newGlobalOrder.includes(baseCurrency)) {
                    newGlobalOrder.push(baseCurrency);
                }
                dragItem.current = null;
                dragOverItem.current = null;
                setGlobalOrder(newGlobalOrder);
            };



            const renderHome = () => {
                const visibleCurrencies = pinned.map(code => currencyData.find(c => c.code === code)).filter(Boolean);
                const visibleGold = pinnedGold.map(desc => goldData.find(g => g.description === desc)).filter(Boolean);

                return (
                    <div className="page-container animate-slide-up">
                        <Header title="ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿßŸÑŸÖÿ≠ŸÑŸäÿ©" subtitle="ÿ≥ŸàŸÇ ÿØŸÖÿ¥ŸÇ ŸàÿßŸÑÿµÿßÿ∫ÿ©" time={dbLastUpdate} setActiveTab={setActiveTab} loadData={loadData} />

                        <div className="space-y-6">
                            {loading ? (
                                <div className="text-center py-20 opacity-50 font-bold">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...</div>
                            ) : (
                                <>
                                    {/* Quick Transfer Banner - Subtle & Clean */}
                                    <div className="app-card overflow-hidden bg-brand-dark/5 dark:bg-brand-primary/10 border-none p-4 flex items-center justify-between">
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 bg-brand-primary rounded-xl flex items-center justify-center text-brand-dark shadow-sm">
                                                <IconRenderer icon={Icons.Send} />
                                            </div>
                                            <div>
                                                <h4 className="font-bold text-sm">ÿ≠ŸàÿßŸÑÿßÿ™ USDT ŸÅŸàÿ±Ÿäÿ©</h4>
                                                <p className="text-[10px] text-gray-500 dark:text-gray-400">ÿ£ŸÅÿ∂ŸÑ ÿ≥ÿπÿ± ÿµÿ±ŸÅ ŸÅŸä ÿßŸÑÿ≥ŸàŸÇ</p>
                                            </div>
                                        </div>
                                        <button onClick={() => setActiveTab('transfer')} className="btn-primary py-2 px-4 text-xs font-bold">ÿ≠ŸàŸëŸÑ ÿßŸÑÿ¢ŸÜ</button>
                                    </div>

                                    {/* Featured Rates Grid - Professional Style */}
                                    <section>
                                        <div className="flex items-center justify-between mb-4">
                                            <h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2">
                                                <span className="w-1.5 h-4 bg-brand-primary rounded-full"></span>
                                                ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿµÿ±ŸÅ
                                            </h3>
                                            <button onClick={() => setActiveTab('settings')} className="text-xs font-bold text-brand-primary">ÿ™ÿÆÿµŸäÿµ ÿßŸÑÿπÿ±ÿ∂</button>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {visibleCurrencies.length > 0 ? visibleCurrencies.map((c, i) => {
                                                const { flag } = getFlagAndCode(c.name);
                                                return <RateCard key={c.code} title={c.name} buy={c.buy_price} sell={c.sell_price} icon={flag} code={c.code} stats={c.stats} onClick={() => setSelectedCurrency(c)} draggable={true} onDragStart={() => (dragItem.current = i)} onDragEnter={() => (dragOverItem.current = i)} onDragEnd={handleSort} />;
                                            }) : <div className="col-span-full app-card p-6 text-center text-xs text-gray-400 font-bold">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿπŸÖŸÑÿßÿ™ ŸÖÿ´ÿ®ÿ™ÿ©.</div>}
                                        </div>
                                    </section>

                                    {/* Energy Section - Clean Cards */}
                                    {showEnergy && (() => {
                                        const usdRate = currencyData.find(c => c.code === 'USD');
                                        if (!usdRate) return null;
                                        const rate = parseFloat(usdRate.sell_price || 0);

                                        const energyItems = {
                                            benzene: {
                                                id: 'benzene',
                                                title: "ÿßŸÑÿ®ŸÜÿ≤ŸäŸÜ (ÿ£ŸàŸÉÿ™ÿßŸÜ 95)",
                                                priceUSD: "0.85",
                                                priceSYP: rate * 0.85,
                                                icon: <IconRenderer icon={Icons.Fuel} />,
                                                iconColor: "text-orange-500",
                                                stats: usdRate.stats
                                            },
                                            diesel: {
                                                id: 'diesel',
                                                title: "ÿßŸÑŸÖÿßÿ≤Ÿàÿ™ (ÿßŸÑÿØŸäÿ≤ŸÑ)",
                                                priceUSD: "0.75",
                                                priceSYP: rate * 0.75,
                                                icon: <IconRenderer icon={Icons.Droplet} />,
                                                iconColor: "text-blue-500",
                                                stats: usdRate.stats
                                            }
                                        };

                                        const orderedEnergy = energyOrder.map(id => energyItems[id]).filter(Boolean);

                                        return (
                                            <section>
                                                <div className="flex items-center justify-between mb-4">
                                                    <h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2">
                                                        <span className="w-1.5 h-4 bg-orange-500 rounded-full"></span>
                                                        ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ∑ÿßŸÇÿ©
                                                    </h3>
                                                </div>
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    {orderedEnergy.map((energy, i) => (
                                                        <EnergyCard
                                                            key={energy.id}
                                                            title={energy.title}
                                                            priceUSD={energy.priceUSD}
                                                            priceSYP={energy.priceSYP}
                                                            icon={energy.icon}
                                                            iconColor={energy.iconColor}
                                                            stats={energy.stats}
                                                            onClick={() => setSelectedEnergy(energy)}
                                                            draggable={true}
                                                            onDragStart={() => (dragItem.current = i)}
                                                            onDragEnter={() => (dragOverItem.current = i)}
                                                            onDragEnd={handleEnergySort}
                                                        />
                                                    ))}
                                                </div>
                                            </section>
                                        );
                                    })()}

                                    {/* Condensed Gold Section */}
                                    {showGold && (
                                        <section>
                                            <div className="flex items-center justify-between mb-4">
                                                <h3 className="font-bold text-gray-800 dark:text-white flex items-center gap-2">
                                                    <span className="w-1.5 h-4 bg-yellow-500 rounded-full"></span>
                                                    ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ∞Ÿáÿ®
                                                </h3>
                                                <button onClick={() => setActiveTab('gold')} className="text-xs font-bold text-yellow-500">ÿßŸÑÿ™ŸÅÿßÿµŸäŸÑ</button>
                                            </div>
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                {visibleGold.length > 0 ? visibleGold.map((g, i) => (
                                                    <RateCard
                                                        key={`g-${i}`}
                                                        title={g.description}
                                                        buy={g.buy_price}
                                                        sell={g.sell_price}
                                                        icon={g.description.includes('ÿ£ŸàŸÜÿµÿ©') ? "‚öñÔ∏è" : "üèÜ"}
                                                        code={g.description.includes('ÿ£ŸàŸÜÿµÿ©') ? "OZ" : "GOLD"}
                                                        stats={g.stats}
                                                        onClick={() => setSelectedGoldCard(g)}
                                                        draggable={true}
                                                        onDragStart={() => (dragItem.current = i)}
                                                        onDragEnter={() => (dragOverItem.current = i)}
                                                        onDragEnd={handlePinnedGoldSort}
                                                    />
                                                )) : <div className="col-span-full app-card p-6 text-center text-xs text-gray-400 font-bold">ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ´ÿ®Ÿäÿ™ ÿ£Ÿä ÿπŸäÿßÿ±ÿßÿ™ ÿ∞Ÿáÿ® ŸÑŸÑÿπÿ±ÿ∂.</div>}
                                            </div>
                                        </section>
                                    )}
                                </>
                            )}
                        </div>
                        {selectedCurrency && <CurrencyDetailModal currency={selectedCurrency} onClose={() => setSelectedCurrency(null)} onMove={handleMoveCard} time={dbLastUpdate} />}
                        {selectedGoldCard && <GoldDetailModal gold={selectedGoldCard} onClose={() => setSelectedGoldCard(null)} onMove={handleMoveGold} time={dbLastUpdate} />}
                        {selectedEnergy && <EnergyDetailModal energy={selectedEnergy} onClose={() => setSelectedEnergy(null)} time={dbLastUpdate} />}
                    </div>
                );
            };

            const renderGold = () => {
                const finalDisplayGold = goldOrder.map(desc => goldData.find(g => g.description === desc)).filter(Boolean);
                const activeGold = goldData.find(g => (g.id || g.description) === selectedGoldId) || goldData.find(g => !g.description.includes('ÿ£ŸàŸÜÿµÿ©')) || goldData[0];
                const weight = parseFloat(goldCalcWeight) || 0;
                const fee = parseFloat(goldCalcFee) || 0;
                const goldPrice = activeGold ? parseFloat(activeGold[goldCalcMode === 'sell' ? 'sell_price' : 'buy_price']) : 0;
                const rawTotal = weight * goldPrice;
                const feeTotal = weight * fee;
                const finalTotal = rawTotal + feeTotal;

                return (
                    <div className="page-container animate-slide-up">
                        <Header title="ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ∞Ÿáÿ®" subtitle="ÿ™ÿ≠ÿØŸäÿ´ ŸÑÿ≠ÿ∏Ÿä ŸÖŸÜ ÿßŸÑÿ®Ÿàÿ±ÿµÿ©" time={dbLastUpdate} setActiveTab={setActiveTab} loadData={loadData} />

                        <div className="space-y-6">
                            {loading ? (
                                <div className="text-center py-20 opacity-50 font-bold">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...</div>
                            ) : (
                                <>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {finalDisplayGold.map((g, i) => {
                                            const isOunce = g.description.includes('ÿ£ŸàŸÜÿµÿ©') || g.description.includes('Ounce');
                                            const karatMatch = g.description.match(/(\d+)/);
                                            const displayCode = isOunce ? 'OZ' : (karatMatch ? `K${karatMatch[0]}` : `K${24 - i}`);
                                            const displayIcon = isOunce ? "‚öñÔ∏è" : "‚ú®";

                                            return (
                                                <RateCard
                                                    key={g.description}
                                                    title={g.description}
                                                    buy={g.buy_price}
                                                    sell={g.sell_price}
                                                    icon={displayIcon}
                                                    code={displayCode}
                                                    stats={g.stats}
                                                    isUsd={isOunce}
                                                    onClick={() => setSelectedGoldCard(g)}
                                                    draggable={true}
                                                    onDragStart={() => (dragItem.current = i)}
                                                    onDragEnter={() => (dragOverItem.current = i)}
                                                    onDragEnd={handleGoldSort}
                                                />
                                            );
                                        })}
                                    </div>

                                    {/* Professional Calculator Section */}
                                    <div className="app-card overflow-hidden">
                                        <div className="p-6 bg-brand-dark dark:bg-slate-800 text-white">
                                            <h3 className="font-bold text-lg flex items-center gap-3">
                                                <IconRenderer icon={Icons.Calculator} />
                                                ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿ∞Ÿáÿ® ÿßŸÑÿ∞ŸÉŸäÿ©
                                            </h3>
                                            <p className="text-xs text-white/60 mt-1">ÿßÿ≠ÿ≥ÿ® ŸÇŸäŸÖÿ© ŸÖÿ¨ŸàŸáÿ±ÿßÿ™ŸÉ ÿ≠ÿ≥ÿ® ÿπŸäÿßÿ± ÿßŸÑŸäŸàŸÖ</p>
                                        </div>
                                        <div className="p-6 space-y-6">
                                            <div>
                                                <label className="text-xs font-bold text-gray-500 mb-3 block">ÿßÿÆÿ™ÿ± ÿßŸÑÿπŸäÿßÿ±</label>
                                                <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">
                                                    {goldData.filter(g => !g.description.includes('ÿ£ŸàŸÜÿµÿ©') && !g.description.includes('Ounce')).map((g, i) => {
                                                        const isActive = (g.id || g.description) === (activeGold?.id || activeGold?.description);
                                                        return (
                                                            <button
                                                                key={i}
                                                                onClick={() => setSelectedGoldId(g.id || g.description)}
                                                                className={`flex-shrink-0 px-4 py-2 rounded-xl text-xs font-bold transition-all border ${isActive ? 'bg-brand-primary text-brand-dark border-brand-primary' : 'bg-gray-50 dark:bg-slate-700 text-gray-600 dark:text-gray-300 border-gray-100 dark:border-gray-600 hover:bg-gray-100'}`}
                                                            >
                                                                {g.description}
                                                            </button>
                                                        );
                                                    })}
                                                </div>
                                            </div>

                                            <div className="flex bg-gray-100 dark:bg-slate-900 p-1 rounded-xl">
                                                <button onClick={() => setGoldCalcMode('sell')} className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${goldCalcMode === 'sell' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ŸÖÿ®Ÿäÿπ (ÿßŸÑÿ≤ÿ®ŸàŸÜ Ÿäÿ®Ÿäÿπ)</button>
                                                <button onClick={() => setGoldCalcMode('buy')} className={`flex-1 py-2 text-xs font-bold rounded-lg transition-all ${goldCalcMode === 'buy' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ÿ¥ÿ±ÿßÿ° (ÿßŸÑÿ≤ÿ®ŸàŸÜ Ÿäÿ¥ÿ™ÿ±Ÿä)</button>
                                            </div>

                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="space-y-1">
                                                    <label className="text-[10px] text-gray-400 font-bold uppercase px-1">ÿßŸÑŸàÿ≤ŸÜ (ÿ∫ÿ±ÿßŸÖ)</label>
                                                    <input type="number" value={goldCalcWeight} onChange={(e) => setGoldCalcWeight(e.target.value)} placeholder="0.00" className="app-input num-en" />
                                                </div>
                                                <div className="space-y-1">
                                                    <label className="text-[10px] text-gray-400 font-bold uppercase px-1">ÿµŸäÿßÿ∫ÿ© (ŸÑŸÑÿ∫ÿ±ÿßŸÖ)</label>
                                                    <input type="number" value={goldCalcFee} onChange={(e) => setGoldCalcFee(e.target.value)} placeholder="0" className="app-input num-en" />
                                                </div>
                                            </div>

                                            <div className="bg-brand-primary/5 dark:bg-brand-primary/10 rounded-2xl p-5 border border-brand-primary/20">
                                                <div className="flex justify-between items-center mb-4 pb-4 border-b border-brand-primary/10">
                                                    <div>
                                                        <p className="text-xs font-bold text-gray-500">ÿ≥ÿπÿ± ÿßŸÑÿ∫ÿ±ÿßŸÖ (ÿÆÿßŸÖ)</p>
                                                        <p className="text-sm font-bold num-en">{goldPrice.toLocaleString()}</p>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className="text-xs font-bold text-gray-500">ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿµŸÜÿπŸäÿ©</p>
                                                        <p className="text-sm font-bold num-en">{(weight * fee).toLocaleString()}</p>
                                                    </div>
                                                </div>
                                                <div className="flex justify-between items-center">
                                                    <div>
                                                        <p className="text-sm font-bold text-brand-dark dark:text-brand-light">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä</p>
                                                        <p className="text-[10px] text-gray-400">ÿ≥ÿπÿ± ÿ™ŸÇÿØŸäÿ±Ÿä ÿ™ŸÇÿ±Ÿäÿ®Ÿä</p>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className="text-2xl font-black text-brand-primary num-en">{finalTotal.toLocaleString()}</p>
                                                        <p className="text-[10px] font-bold text-gray-400">ŸÑŸäÿ±ÿ© ÿ≥Ÿàÿ±Ÿäÿ©</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </>
                            )}
                        </div>
                        {selectedGoldCard && <GoldDetailModal gold={selectedGoldCard} onClose={() => setSelectedGoldCard(null)} onMove={handleMoveGold} time={dbLastUpdate} />}
                    </div>
                );
            };

            const renderGlobal = () => {
                let convResult = 0;
                if (globalRawData) {
                    const fromRate = convFrom === 'USD' ? 1 : globalRawData[convFrom]?.value || 1;
                    const toRate = convTo === 'USD' ? 1 : globalRawData[convTo]?.value || 1;
                    convResult = (convAmount / fromRate) * toRate;
                }
                let displayList = [];
                if (globalRawData) {
                    let conversionFactor = 1;
                    if (baseCurrency === 'EUR') {
                        const eurRate = globalRawData['EUR']?.value;
                        if (eurRate) conversionFactor = 1 / eurRate;
                    }
                    globalOrder.forEach(key => {
                        if (key === baseCurrency) return;
                        if (globalRawData[key] && GLOBAL_DISPLAY_MAP[key]) {
                            const rawRate = globalRawData[key].value;
                            const baseRate = rawRate * conversionFactor;
                            const sell = baseRate * (1 + SPREAD_PERCENTAGE);
                            const buy = baseRate * (1 - SPREAD_PERCENTAGE);
                            displayList.push({ code: key, buy: buy, sell: sell, ...GLOBAL_DISPLAY_MAP[key] });
                        }
                    });
                }
                return (
                    <div className="page-container animate-slide-up">
                        <Header title="ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿπÿßŸÑŸÖŸäÿ©" subtitle="ŸÖÿ®ÿßÿ¥ÿ± ŸÖŸÜ ÿßŸÑÿ£ÿ≥ŸàÿßŸÇ ÿßŸÑÿØŸàŸÑŸäÿ©" time={apiLastUpdate} setActiveTab={setActiveTab} loadData={loadData} />

                        <div className="space-y-6">
                            {/* Unified Global Calculator */}
                            <div className="app-card p-6">
                                <h3 className="font-bold text-sm text-gray-500 mb-6 flex items-center gap-2">
                                    <IconRenderer icon={Icons.Calculator} />
                                    ŸÖÿ≠ŸàŸÑ ÿßŸÑÿπŸÖŸÑÿßÿ™ ÿßŸÑÿπÿßŸÑŸÖŸä
                                </h3>
                                <div className="space-y-5">
                                    <div className="space-y-1">
                                        <label className="text-[10px] text-gray-400 font-bold px-1">ÿßŸÑŸÖÿ®ŸÑÿ∫</label>
                                        <input type="number" value={convAmount} onChange={(e) => setConvAmount(e.target.value)} className="app-input num-en text-xl" />
                                    </div>
                                    <div className="grid grid-cols-[1fr,auto,1fr] items-center gap-3">
                                        <div className="space-y-1">
                                            <label className="text-[10px] text-gray-400 font-bold px-1">ŸÖŸÜ</label>
                                            <select value={convFrom} onChange={(e) => setConvFrom(e.target.value)} className="app-input text-sm font-bold">
                                                <option value="USD">üá∫üá∏ USD</option>
                                                {Object.keys(GLOBAL_DISPLAY_MAP).map(k => <option key={k} value={k}>{GLOBAL_DISPLAY_MAP[k].flag} {k}</option>)}
                                            </select>
                                        </div>
                                        <button onClick={() => { const temp = convFrom; setConvFrom(convTo); setConvTo(temp); }} className="mt-5 w-10 h-10 rounded-full bg-gray-100 dark:bg-slate-700 flex items-center justify-center text-gray-500 hover:text-brand-primary transition">
                                            <div className="rotate-90"><IconRenderer icon={Icons.ArrowDownUp} /></div>
                                        </button>
                                        <div className="space-y-1">
                                            <label className="text-[10px] text-gray-400 font-bold px-1">ÿ•ŸÑŸâ</label>
                                            <select value={convTo} onChange={(e) => setConvTo(e.target.value)} className="app-input text-sm font-bold">
                                                <option value="USD">üá∫üá∏ USD</option>
                                                {Object.keys(GLOBAL_DISPLAY_MAP).map(k => <option key={k} value={k}>{GLOBAL_DISPLAY_MAP[k].flag} {k}</option>)}
                                            </select>
                                        </div>
                                    </div>
                                    <div className="bg-slate-50 dark:bg-slate-900 rounded-xl p-4 flex justify-between items-center border border-dashed border-slate-200 dark:border-slate-700">
                                        <span className="text-xs font-bold text-gray-500 tracking-tight">ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑÿ™ŸÇÿØŸäÿ±Ÿäÿ©</span>
                                        <div className="text-xl font-black text-brand-primary num-en">
                                            {convResult.toLocaleString('en-US', { maximumFractionDigits: 2 })}
                                            <span className="text-[10px] ml-1 text-gray-400">{convTo}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <section>
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="font-bold text-gray-800 dark:text-white">ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ£ÿ≥ÿπÿßÿ±</h3>
                                    <div className="flex bg-gray-200 dark:bg-slate-700 rounded-lg p-0.5">
                                        <button onClick={() => setBaseCurrency('USD')} className={`px-4 py-1 rounded-md text-[10px] font-bold transition ${baseCurrency === 'USD' ? 'bg-white dark:bg-slate-600 shadow text-brand-dark dark:text-white' : 'text-gray-500'}`}>ÿØŸàŸÑÿßÿ± (USD)</button>
                                        <button onClick={() => setBaseCurrency('EUR')} className={`px-4 py-1 rounded-md text-[10px] font-bold transition ${baseCurrency === 'EUR' ? 'bg-white dark:bg-slate-600 shadow text-brand-dark dark:text-white' : 'text-gray-500'}`}>ŸäŸàÿ±Ÿà (EUR)</button>
                                    </div>
                                </div>

                                {globalLoading && !globalRawData ? (
                                    <div className="text-center py-20 opacity-50 font-bold">ÿ¨ÿßÿ±Ÿä ÿ¨ŸÑÿ® ÿßŸÑÿ£ÿ≥ÿπÿßÿ±...</div>
                                ) : (
                                    <>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {displayList.map((curr, i) => (
                                                <RateCard
                                                    key={curr.code}
                                                    title={curr.name}
                                                    buy={curr.buy}
                                                    sell={curr.sell}
                                                    icon={curr.flag}
                                                    code={curr.code}
                                                    draggable={true}
                                                    onDragStart={() => (dragItem.current = i)}
                                                    onDragEnter={() => (dragOverItem.current = i)}
                                                    onDragEnd={handleGlobalSort}
                                                />
                                            ))}
                                        </div>
                                        <p className="text-center text-[10px] text-gray-400 mt-6 px-4">ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ÿßŸÑÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿπÿßŸÑŸÖŸäÿ© ÿ™ÿÆÿ∂ÿπ ŸÑÿ™ŸÇŸÑÿ®ÿßÿ™ ÿßŸÑÿ≥ŸàŸÇ Ÿàÿ™Ÿèÿ≠ÿØÿ´ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÉŸÑ 45 ÿØŸÇŸäŸÇÿ©.</p>
                                    </>
                                )}
                            </section>
                        </div>
                    </div>
                );
            };

            const renderCalculator = () => {
                const { code: currencyCode } = getFlagAndCode(calcSource?.name || 'USDT');
                const result = calculateValue(calcAmount, calcSource, calcDirection, calcMode);
                const chartData = getChartData(calcSource, timeframeMapping[chartTimeframe], calcMode);
                const chartColor = chartData[chartData.length - 1] >= chartData[0] ? '#10b981' : '#ef4444';
                const isTrendUp = chartData[chartData.length - 1] >= chartData[0];

                return (
                    <div className="page-container animate-slide-up">
                        <Header title="ÿßŸÑŸÖÿ≠ŸàŸÑ ÿßŸÑÿ∞ŸÉŸä" subtitle="ÿØÿ±ÿßÿ≥ÿ© Ÿàÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿ£ÿ≥ÿπÿßÿ±" time={dbLastUpdate} setActiveTab={setActiveTab} loadData={loadData} />

                        <div className="space-y-6">
                            <div className="app-card p-6">
                                <h3 className="font-bold text-sm text-gray-500 mb-6 flex items-center gap-2">
                                    <IconRenderer icon={Icons.Calculator} />
                                    ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ©
                                </h3>

                                <div className="space-y-6">
                                    <div className="flex items-center justify-between">
                                        <label className="text-xs font-bold text-gray-400">ÿßÿ™ÿ¨ÿßŸá ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ</label>
                                        <div className="flex bg-gray-100 dark:bg-slate-900 p-1 rounded-xl">
                                            <button onClick={() => setCalcDirection('to_syp')} className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${calcDirection === 'to_syp' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ÿ•ŸÑŸâ ŸÑŸäÿ±ÿ©</button>
                                            <button onClick={() => setCalcDirection('from_syp')} className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${calcDirection === 'from_syp' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ŸÖŸÜ ŸÑŸäÿ±ÿ©</button>
                                        </div>
                                    </div>

                                    <div className="flex items-center justify-between">
                                        <label className="text-xs font-bold text-gray-400">ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÖÿπÿ™ŸÖÿØ</label>
                                        <div className="flex bg-gray-100 dark:bg-slate-900 p-1 rounded-xl">
                                            <button onClick={() => setCalcMode('sell')} className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${calcMode === 'sell' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ŸÖÿ®Ÿäÿπ</button>
                                            <button onClick={() => setCalcMode('buy')} className={`px-4 py-1.5 text-[10px] font-bold rounded-lg transition-all ${calcMode === 'buy' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ÿ¥ÿ±ÿßÿ°</button>
                                        </div>
                                    </div>

                                    <div className="space-y-2">
                                        <label className="text-[10px] text-gray-400 font-bold px-1">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑŸÖÿ±ÿßÿØ ÿ™ÿ≠ŸàŸäŸÑŸá</label>
                                        <input type="number" value={calcAmount} onChange={(e) => setCalcAmount(e.target.value)} className="app-input num-en text-2xl font-black" placeholder="0" />
                                    </div>

                                    <div className="space-y-2">
                                        <label className="text-[10px] text-gray-400 font-bold px-1">ÿßÿÆÿ™ÿ± ÿßŸÑÿπŸÖŸÑÿ©</label>
                                        <div className="grid grid-cols-2 md:grid-cols-3 gap-2 max-h-48 overflow-y-auto no-scrollbar p-1">
                                            {currencyData.map((c, i) => {
                                                const { flag, code } = getFlagAndCode(c.name);
                                                const isSelected = calcSource?.name === c.name;
                                                return (
                                                    <button key={i} onClick={() => setCalcSource(c)} className={`flex items-center gap-2 p-2 rounded-xl border transition-all ${isSelected ? 'border-brand-primary bg-brand-primary/5 text-brand-primary' : 'border-gray-100 dark:border-slate-700 text-gray-500'}`}>
                                                        <span className="text-lg">{flag}</span>
                                                        <span className="text-xs font-bold">{code}</span>
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    {calcSource && (
                                        <div className="bg-brand-primary/5 dark:bg-brand-primary/10 rounded-2xl p-6 border border-brand-primary/20 text-center">
                                            <p className="text-[10px] font-bold text-gray-500 mb-1">ÿßŸÑŸÜÿ™Ÿäÿ¨ÿ© ÿßŸÑÿ™ŸÇÿ±Ÿäÿ®Ÿäÿ©</p>
                                            <div className="text-3xl font-black text-brand-primary num-en">
                                                {calcDirection === 'to_syp'
                                                    ? Math.floor(result).toLocaleString('en-US')
                                                    : result.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
                                                }
                                                <span className="text-sm mr-2 text-gray-400">{calcDirection === 'to_syp' ? 'ŸÑ.ÿ≥' : currencyCode}</span>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {calcSource && (
                                <div className="app-card overflow-hidden">
                                    <div className="p-4 border-b border-gray-100 dark:border-slate-700 flex justify-between items-center">
                                        <div className="flex items-center gap-2">
                                            <div className={`p-2 rounded-xl ${isTrendUp ? 'bg-green-50 text-green-600' : 'bg-red-50 text-red-600'}`}>
                                                <IconRenderer icon={isTrendUp ? Icons.TrendUp : Icons.TrendDown} />
                                            </div>
                                            <div>
                                                <h4 className="font-bold text-xs dark:text-white">ÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑÿ≥ÿπÿ±</h4>
                                                <p className="text-[9px] text-gray-400">{calcSource.name}</p>
                                            </div>
                                        </div>
                                        <div className="flex bg-gray-100 dark:bg-slate-900 p-1 rounded-lg">
                                            {['1D', '1W', '1M', '1Y'].map(tf => (
                                                <button key={tf} onClick={() => setChartTimeframe(tf)} className={`px-2.5 py-1 text-[9px] font-bold rounded-md transition ${chartTimeframe === tf ? 'bg-white dark:bg-slate-700 shadow text-brand-primary' : 'text-gray-400'}`}>
                                                    {tf === '1D' ? 'ŸäŸàŸÖ' : tf === '1W' ? 'ÿ£ÿ≥ÿ®' : tf === '1M' ? 'ÿ¥Ÿáÿ±' : 'ÿ≥ŸÜÿ©'}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="p-6">
                                        <div className="h-40 relative"><LineChart data={chartData} color={chartColor} /></div>
                                        <div className="grid grid-cols-2 gap-4 mt-6">
                                            <div className="bg-gray-50 dark:bg-slate-900/50 p-3 rounded-xl flex items-center gap-3">
                                                <IconRenderer icon={Icons.Target} />
                                                <div>
                                                    <p className="text-[9px] text-gray-400 font-bold">ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿßŸÅÿ™ÿ™ÿßÿ≠</p>
                                                    <p className="text-sm font-black num-en">{chartData[0]?.toLocaleString('en-US')}</p>
                                                </div>
                                            </div>
                                            <div className="bg-gray-50 dark:bg-slate-900/50 p-3 rounded-xl flex items-center gap-3">
                                                <IconRenderer icon={Icons.Clock} />
                                                <div>
                                                    <p className="text-[9px] text-gray-400 font-bold">ÿ¢ÿÆÿ± ÿ•ÿ∫ŸÑÿßŸÇ</p>
                                                    <p className="text-sm font-black num-en">{chartData[chartData.length - 1]?.toLocaleString('en-US')}</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const renderSettings = () => (
                <div className="page-container animate-slide-up">
                    <Header title="ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™" subtitle="ÿ™ÿÆÿµŸäÿµ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ" time={null} showDate={false} showBack={true} onBack={() => setActiveTab('home')} setActiveTab={setActiveTab} loadData={loadData} />

                    <div className="space-y-6">
                        {/* Theme Preference Module */}
                        <div className="app-card p-5">
                            <div className="flex items-center gap-4 mb-6">
                                <div className="w-12 h-12 rounded-2xl bg-gray-100 dark:bg-slate-700 flex items-center justify-center text-gray-500 shadow-sm">
                                    <IconRenderer icon={Icons.Moon} />
                                </div>
                                <div>
                                    <h3 className="font-bold text-gray-800 dark:text-white">ŸÜŸÖÿ∑ ÿßŸÑŸÖÿ∏Ÿáÿ±</h3>
                                    <p className="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Appearance Settings</p>
                                </div>
                            </div>

                            <div className="flex bg-gray-100 dark:bg-slate-900 p-1 rounded-xl">
                                {['system', 'light', 'dark'].map((mode) => (
                                    <button
                                        key={mode}
                                        onClick={() => setThemePreference(mode)}
                                        className={`flex-1 py-3 rounded-lg text-xs font-bold transition-all flex items-center justify-center gap-2 ${themePreference === mode
                                            ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-brand-primary'
                                            : 'text-gray-500 dark:text-gray-400'
                                            }`}
                                    >
                                        <IconRenderer icon={mode === 'system' ? Icons.Globe : mode === 'dark' ? Icons.Moon : Icons.Sun} />
                                        <span>{mode === 'system' ? 'ÿ™ŸÑŸÇÿßÿ¶Ÿä' : mode === 'dark' ? 'ŸÖÿ∏ŸÑŸÖ' : 'ŸÅÿßÿ™ÿ≠'}</span>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Interface Customization */}
                        <div className="app-card overflow-hidden">
                            <button
                                onClick={() => setIsCustomizeOpen(!isCustomizeOpen)}
                                className="w-full p-5 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-slate-800 transition-colors"
                            >
                                <div className="flex items-center gap-4">
                                    <div className="w-12 h-12 rounded-2xl bg-brand-primary/10 flex items-center justify-center text-brand-primary shadow-sm">
                                        <IconRenderer icon={Icons.Settings} />
                                    </div>
                                    <div className="text-right">
                                        <h3 className="font-bold text-gray-800 dark:text-white">ÿ™ÿÆÿµŸäÿµ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</h3>
                                        <p className="text-[10px] text-gray-400 font-bold uppercase tracking-wider">Personalize Dashboard</p>
                                    </div>
                                </div>
                                <div className={`transition-transform duration-300 text-gray-300 ${isCustomizeOpen ? 'rotate-180' : ''}`}>
                                    <IconRenderer icon={Icons.ArrowDown} />
                                </div>
                            </button>

                            <div className={`transition-all duration-300 overflow-hidden ${isCustomizeOpen ? 'max-h-[1200px] opacity-100' : 'max-h-0 opacity-0'}`}>
                                <div className="p-6 space-y-8 bg-gray-50/50 dark:bg-slate-900/50 border-t border-gray-100 dark:border-slate-800">

                                    {/* Gold Selector */}
                                    <div>
                                        <div className="flex items-center justify-between mb-4">
                                            <h4 className="text-xs font-bold text-gray-500">ÿ®ÿ∑ÿßŸÇÿ© ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ∞Ÿáÿ®</h4>
                                            <div onClick={() => setShowGold(!showGold)} className={`w-12 h-6 rounded-full transition-all cursor-pointer flex items-center px-1 ${showGold ? 'bg-brand-primary' : 'bg-gray-200'}`}>
                                                <div className={`w-4 h-4 bg-white rounded-full shadow transition-all ${showGold ? 'translate-x-6' : 'translate-x-0'}`}></div>
                                            </div>
                                        </div>
                                        {showGold && (
                                            <div className="grid grid-cols-2 gap-2 mt-4 animate-slide-up">
                                                {goldData.map((g, i) => {
                                                    const isSelected = pinnedGold.includes(g.description);
                                                    return (
                                                        <button key={i} onClick={() => { if (isSelected) setPinnedGold(pinnedGold.filter(p => p !== g.description)); else setPinnedGold([...pinnedGold, g.description]); }} className={`py-3 px-2 rounded-xl text-[10px] font-bold border transition-all ${isSelected ? 'bg-yellow-500 text-white border-yellow-600 shadow-sm' : 'bg-white dark:bg-slate-700 text-gray-500 border-gray-100 dark:border-slate-800'}`}>{g.description}</button>
                                                    );
                                                })}
                                            </div>
                                        )}
                                    </div>

                                    {/* Energy Toggle */}
                                    <div className="flex items-center justify-between">
                                        <h4 className="text-xs font-bold text-gray-500">ÿ®ÿ∑ÿßŸÇÿ© ÿ£ÿ≥ÿπÿßÿ± ÿßŸÑÿ∑ÿßŸÇÿ©</h4>
                                        <div onClick={() => setShowEnergy(!showEnergy)} className={`w-12 h-6 rounded-full transition-all cursor-pointer flex items-center px-1 ${showEnergy ? 'bg-brand-primary' : 'bg-gray-200'}`}>
                                            <div className={`w-4 h-4 bg-white rounded-full shadow transition-all ${showEnergy ? 'translate-x-6' : 'translate-x-0'}`}></div>
                                        </div>
                                    </div>

                                    {/* Currency Pinner */}
                                    <div>
                                        <h4 className="text-xs font-bold text-gray-500 mb-4">ÿ™ÿ´ÿ®Ÿäÿ™ ÿßŸÑÿπŸÖŸÑÿßÿ™</h4>
                                        <div className="grid grid-cols-2 gap-2">
                                            {currencyData.map((c, i) => {
                                                const { flag, code } = getFlagAndCode(c.name);
                                                const isPinned = pinned.includes(code);
                                                return (
                                                    <button key={i} onClick={() => { if (isPinned) setPinned(pinned.filter(p => p !== code)); else setPinned([...pinned, code]); }} className={`p-3 rounded-xl border flex items-center gap-3 transition-all ${isPinned ? 'bg-brand-primary/5 border-brand-primary text-brand-dark dark:text-brand-light' : 'bg-white dark:bg-slate-700 border-gray-100 dark:border-slate-800 text-gray-400'}`}>
                                                        <span className="text-lg">{flag}</span>
                                                        <span className="text-xs font-bold">{code}</span>
                                                        {isPinned && <div className="ml-auto w-1.5 h-1.5 rounded-full bg-brand-primary shadow-sm"></div>}
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Social & Contact */}
                        <div className="app-card p-5">
                            <h3 className="font-bold text-sm text-gray-800 dark:text-white mb-6">ÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÜÿß</h3>
                            <div className="grid grid-cols-2 gap-4">
                                <a href="https://t.me/Lairas24" target="_blank" className="btn-secondary py-3 text-sm">
                                    <IconRenderer icon={Icons.Telegram} />
                                    ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ
                                </a>
                                <a href="https://www.facebook.com/share/1D74ZvQS9v/" target="_blank" className="btn-secondary py-3 text-sm">
                                    <IconRenderer icon={Icons.Facebook} />
                                    ŸÅŸäÿ≥ÿ®ŸàŸÉ
                                </a>
                            </div>
                        </div>

                        <div className="text-center pb-4">
                            <p className="text-[10px] text-gray-400 font-bold uppercase tracking-widest opacity-50">Laira 2024 Version 2.0</p>
                        </div>
                    </div>
                </div>
            );

            const renderTransfer = () => {
                const services = [
                    { id: 'global', title: 'ÿ≠ŸàÿßŸÑÿßÿ™ ÿØŸàŸÑŸäÿ©', icon: Icons.Globe, color: 'bg-indigo-600' },
                    { id: 'sham', title: 'ÿ¥ÿßŸÖ ŸÉÿßÿ¥', icon: Icons.Wallet, color: 'bg-orange-600' },
                    { id: 'mtn', title: 'ÿ±ÿµŸäÿØ MTN', icon: Icons.Smartphone, color: 'bg-yellow-500' },
                    { id: 'syriatel', title: 'Syriatel', icon: Icons.Smartphone, color: 'bg-red-600' },
                ];

                const activeService = services.find(s => s.id === transferService) || services[0];
                const baseUsdRate = currencyData.find(c => c.name.includes('ÿØŸàŸÑÿßÿ±'))?.buy_price || 15000;
                const isTelecom = transferService === 'mtn' || transferService === 'syriatel';
                const effectiveRate = isTelecom ? (baseUsdRate * 0.8) : parseFloat(baseUsdRate);
                const FEE_PERCENT = isTelecom ? 0 : 0.02;

                const amountVal = parseFloat(transferAmount) || 0;
                const feeVal = amountVal * FEE_PERCENT;

                // Calculations
                const totalToPay = transferFeeType === 'add' ? (amountVal + feeVal) : amountVal;
                const actualTransferBase = transferFeeType === 'add' ? amountVal : (amountVal - feeVal);

                let receiveAmount = 0;
                let receiveCurrencyLabel = '';

                if (transferDirection === 'USDT_SYP') {
                    receiveCurrencyLabel = transferReceiveCurrency;
                    receiveAmount = actualTransferBase * (transferReceiveCurrency === 'SYP' ? effectiveRate : 1);
                } else {
                    receiveCurrencyLabel = 'USDT';
                    receiveAmount = actualTransferBase / effectiveRate;
                }

                const handleCopy = (text) => {
                    navigator.clipboard.writeText(text);
                    alert("ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿπŸÜŸàÿßŸÜ ŸÑŸÑŸÖÿ≠ŸÅÿ∏ÿ©");
                };

                const handleSendTelegram = () => {
                    if (!transferForm.name || !transferForm.mobile) {
                        alert("Ÿäÿ±ÿ¨Ÿâ ÿ•ŸÉŸÖÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©");
                        return;
                    }
                    const sendCurr = transferDirection === 'USDT_SYP' ? 'USDT' : 'SYP';
                    const message = `ÿ∑ŸÑÿ® ÿ™ÿ≠ŸàŸäŸÑ ÿ¨ÿØŸäÿØ: ${activeService.title}\n` +
                        `ÿ•ÿ±ÿ≥ÿßŸÑ: ${totalToPay.toLocaleString()} ${sendCurr}\n` +
                        `ÿßÿ≥ÿ™ŸÑÿßŸÖ: ${receiveAmount.toLocaleString()} ${receiveCurrencyLabel}\n` +
                        `ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ: ${transferForm.name}\n` +
                        `ÿßŸÑÿ±ŸÇŸÖ: ${transferForm.mobile}\n` +
                        `ÿßŸÑŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™: ${transferForm.notes || 'ŸÑÿß ŸäŸàÿ¨ÿØ'}`;
                    window.open(`https://t.me/Lairas24?text=${encodeURIComponent(message)}`, '_blank');
                };

                return (
                    <div className="page-container animate-slide-up bg-white dark:bg-slate-950 min-h-screen fixed inset-0 z-50 overflow-y-auto no-scrollbar">
                        <Header title="ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ™ÿ≠ŸàŸäŸÑ" subtitle="ÿ®Ÿàÿßÿ®ÿ© ÿßŸÑÿÆÿØŸÖÿßÿ™ ÿßŸÑŸÖÿßŸÑŸäÿ©" showBack={true} onBack={() => setActiveTab('home')} setActiveTab={setActiveTab} loadData={loadData} />

                        <div className="space-y-6 mt-4 pb-20">
                            {/* Service Selection Grid */}
                            <div className="grid grid-cols-2 gap-3">
                                {services.map(s => (
                                    <button
                                        key={s.id}
                                        onClick={() => { setTransferService(s.id); setTransferStep(1); }}
                                        className={`app-card p-4 transition-all flex flex-col items-center gap-3 ${transferService === s.id ? 'border-brand-primary ring-2 ring-brand-primary/10 bg-brand-primary/5' : 'opacity-60 border-transparent'}`}
                                    >
                                        <div className={`w-12 h-12 rounded-2xl ${s.color} text-white flex items-center justify-center shadow-lg`}>
                                            <IconRenderer icon={s.icon} />
                                        </div>
                                        <span className="text-[10px] font-black uppercase tracking-wider text-gray-500">{s.title}</span>
                                    </button>
                                ))}
                            </div>

                            <div className="app-card p-6 border-none shadow-xl shadow-brand-dark/5 dark:shadow-none">
                                {transferStep === 1 && (
                                    <div className="space-y-6">
                                        <div className="flex items-center justify-between">
                                            <h3 className="font-bold text-sm text-gray-500">ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿπŸÖŸÑŸäÿ©</h3>
                                            <div className="flex bg-gray-100 dark:bg-slate-900 p-1 rounded-xl">
                                                <button onClick={() => setTransferDirection('USDT_SYP')} className={`px-4 py-2 text-[10px] font-bold rounded-lg transition-all ${transferDirection === 'USDT_SYP' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ÿ•ÿ±ÿ≥ÿßŸÑ USDT</button>
                                                <button onClick={() => setTransferDirection('SYP_USDT')} className={`px-4 py-2 text-[10px] font-bold rounded-lg transition-all ${transferDirection === 'SYP_USDT' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ÿ•ÿ±ÿ≥ÿßŸÑ ŸÑŸäÿ±ÿ©</button>
                                            </div>
                                        </div>

                                        <div className="space-y-2">
                                            <label className="text-[10px] text-gray-400 font-bold px-1 uppercase tracking-widest">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑÿµÿßŸÅŸä ŸÑŸÑŸÖÿ±ÿ≥ŸÑ</label>
                                            <div className="relative">
                                                <input type="number" value={transferAmount} onChange={e => setTransferAmount(e.target.value)} className="app-input text-3xl font-black num-en pr-16" placeholder="0.00" />
                                                <span className="absolute left-4 top-1/2 -translate-y-1/2 text-xs font-bold text-gray-400">{transferDirection === 'USDT_SYP' ? 'USDT' : 'SYP'}</span>
                                            </div>
                                        </div>

                                        <div className="flex items-center justify-between">
                                            <label className="text-xs font-bold text-gray-400">ÿ∑ÿ±ŸäŸÇÿ© ÿßÿ≠ÿ™ÿ≥ÿßÿ® ÿßŸÑÿ±ÿ≥ŸàŸÖ</label>
                                            <div className="flex bg-gray-100 dark:bg-slate-900 p-1 rounded-xl">
                                                <button onClick={() => setTransferFeeType('add')} className={`px-3 py-1.5 text-[10px] font-bold rounded-lg ${transferFeeType === 'add' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>Ÿäÿ∂ÿßŸÅ ŸÑŸÑŸÖÿ®ŸÑÿ∫</button>
                                                <button onClick={() => setTransferFeeType('deduct')} className={`px-3 py-1.5 text-[10px] font-bold rounded-lg ${transferFeeType === 'deduct' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ŸäÿÆÿµŸÖ ŸÖŸÜ ÿßŸÑŸÖÿ®ŸÑÿ∫</button>
                                            </div>
                                        </div>

                                        {transferDirection === 'USDT_SYP' && (
                                            <div className="flex items-center justify-between">
                                                <label className="text-xs font-bold text-gray-400">ÿπŸÖŸÑÿ© ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ</label>
                                                <div className="flex bg-gray-100 dark:bg-slate-900 p-1 rounded-xl">
                                                    <button onClick={() => setTransferReceiveCurrency('SYP')} className={`px-3 py-1.5 text-[10px] font-bold rounded-lg ${transferReceiveCurrency === 'SYP' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ŸÑŸäÿ±ÿ© ÿ≥Ÿàÿ±Ÿäÿ©</button>
                                                    <button onClick={() => setTransferReceiveCurrency('USD')} className={`px-3 py-1.5 text-[10px] font-bold rounded-lg ${transferReceiveCurrency === 'USD' ? 'bg-white dark:bg-slate-700 shadow text-brand-dark dark:text-white' : 'text-gray-400'}`}>ÿØŸàŸÑÿßÿ± ŸÉÿßÿ¥</button>
                                                </div>
                                            </div>
                                        )}

                                        <div className="bg-gray-50 dark:bg-slate-900 rounded-2xl p-6 space-y-4 border border-gray-100 dark:border-slate-800">
                                            <div className="flex justify-between items-center text-[10px] font-bold text-gray-400">
                                                <span>ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑŸÖÿ∑ŸÑŸàÿ® ÿØŸÅÿπŸá</span>
                                                <span className="text-gray-800 dark:text-white num-en text-sm">{totalToPay.toLocaleString()} {transferDirection === 'USDT_SYP' ? 'USDT' : 'SYP'}</span>
                                            </div>
                                            <div className="flex justify-between items-center text-[10px] font-bold text-gray-400">
                                                <span>ÿ±ÿ≥ŸàŸÖ ÿßŸÑÿÆÿØŸÖÿ© ({FEE_PERCENT * 100}%)</span>
                                                <span className="text-rose-500 num-en">{feeVal.toLocaleString()} {transferDirection === 'USDT_SYP' ? 'USDT' : 'SYP'}</span>
                                            </div>
                                            <div className="h-px bg-gray-200 dark:bg-slate-800 my-2"></div>
                                            <div className="flex justify-between items-end">
                                                <div>
                                                    <span className="text-xs font-bold text-gray-500 block mb-1">ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿßŸÑÿ∞Ÿä ÿ≥ŸäÿµŸÑŸá</span>
                                                    <div className="flex items-baseline gap-2">
                                                        <span className="text-2xl font-black text-brand-primary num-en">{receiveAmount.toLocaleString()}</span>
                                                        <span className="text-xs font-bold text-brand-primary">{receiveCurrencyLabel}</span>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <span className="text-[10px] font-bold text-gray-400 block mb-1">ÿ≥ÿπÿ± ÿßŸÑÿµÿ±ŸÅ</span>
                                                    <span className="text-xs font-bold text-gray-600 dark:text-gray-300 num-en">{effectiveRate.toLocaleString()}</span>
                                                </div>
                                            </div>
                                        </div>

                                        <button disabled={amountVal <= 0} onClick={() => setTransferStep(2)} className="btn-primary w-full py-4 text-sm font-bold shadow-xl shadow-brand-primary/20">ŸÖÿ™ÿßÿ®ÿπÿ© ÿßŸÑÿπŸÖŸÑŸäÿ©</button>
                                    </div>
                                )}

                                {transferStep === 2 && (
                                    <div className="space-y-8 text-center animate-in fade-in duration-300">
                                        <button onClick={() => setTransferStep(1)} className="flex items-center gap-2 text-[10px] text-gray-400 font-bold hover:text-brand-primary transition-colors">
                                            <div className="rotate-270"><IconRenderer icon={Icons.ArrowDown} /></div>
                                            ÿπŸàÿØÿ© ŸÑŸÑÿÆÿ∑Ÿàÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ©
                                        </button>

                                        <div>
                                            <h3 className="font-bold text-lg mb-2">ÿ™ÿ≠ŸàŸäŸÑ USDT (TRC20)</h3>
                                            <p className="text-xs text-gray-400">ÿßŸÖÿ≥ÿ≠ ÿßŸÑŸÉŸàÿØ ÿ£Ÿà ÿßŸÜÿ≥ÿÆ ÿßŸÑÿπŸÜŸàÿßŸÜ ŸÑŸÑÿ•ÿ±ÿ≥ÿßŸÑ</p>
                                        </div>

                                        <div className="bg-white p-5 rounded-3xl inline-block shadow-2xl shadow-brand-dark/5 border border-gray-100">
                                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=TZ46vwaAxUSiwPo61RaXfqZ4c7jLFDQC4T" className="w-48 h-48" />
                                        </div>

                                        <div className="bg-gray-50 dark:bg-slate-900 p-4 rounded-2xl flex items-center justify-between gap-4 border border-gray-100 dark:border-slate-800">
                                            <span className="text-[10px] font-mono font-bold text-gray-500 truncate">TZ46vwaAxUSiwPo61RaXfqZ4c7jLFDQC4T</span>
                                            <button onClick={() => handleCopy('TZ46vwaAxUSiwPo61RaXfqZ4c7jLFDQC4T')} className="bg-white dark:bg-slate-800 p-2.5 rounded-xl shadow-sm text-brand-primary hover:scale-110 transition-transform">
                                                <IconRenderer icon={Icons.Copy} />
                                            </button>
                                        </div>

                                        <div className="p-4 bg-orange-50 dark:bg-orange-900/10 rounded-2xl flex gap-3 text-right">
                                            <div className="text-orange-500 mt-0.5"><IconRenderer icon={Icons.Target} /></div>
                                            <p className="text-[10px] text-orange-700 dark:text-orange-400 font-bold leading-relaxed">ÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßÿÆÿ™Ÿäÿßÿ± ÿ¥ÿ®ŸÉÿ© TRC20 ÿπŸÜÿØ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ ŸÑÿ™ÿ¨ŸÜÿ® ŸÅŸÇÿØÿßŸÜ ÿßŸÑÿ£ŸÖŸàÿßŸÑ.</p>
                                        </div>

                                        <button onClick={() => setTransferStep(3)} className="btn-primary w-full py-4 font-bold shadow-xl shadow-brand-primary/20">ÿ™ŸÖ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑÿå ÿßŸÑŸÖÿ™ÿßÿ®ÿπÿ© ŸÑŸÑÿ™ÿ£ŸÉŸäÿØ</button>
                                    </div>
                                )}

                                {transferStep === 3 && (
                                    <div className="space-y-6 animate-in fade-in duration-300">
                                        <button onClick={() => setTransferStep(2)} className="flex items-center gap-2 text-[10px] text-gray-400 font-bold hover:text-brand-primary transition-colors">
                                            <div className="rotate-270"><IconRenderer icon={Icons.ArrowDown} /></div>
                                            ÿπŸàÿØÿ©
                                        </button>

                                        <div>
                                            <h3 className="font-bold text-lg mb-1">ÿ™ÿ£ŸÉŸäÿØ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ</h3>
                                            <p className="text-xs text-gray-400">ÿ≥Ÿäÿ™ŸÖ ÿßŸÑÿ™ŸàÿßÿµŸÑ ŸÖÿπŸÉ ŸÅŸàÿ± ÿ™ÿ£ŸÉŸäÿØ ÿßŸÑÿπŸÖŸÑŸäÿ© ÿπŸÑŸâ ÿßŸÑÿ¥ÿ®ŸÉÿ©</p>
                                        </div>

                                        <div className="space-y-5">
                                            <div className="space-y-1.5">
                                                <label className="text-[10px] text-gray-400 font-bold px-1 uppercase">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ ÿßŸÑÿµÿ±Ÿäÿ≠</label>
                                                <input type="text" value={transferForm.name} onChange={e => setTransferForm({ ...transferForm, name: e.target.value })} className="app-input text-sm" placeholder="ÿßŸÑÿßÿ≥ŸÖ ŸÉŸÖÿß ŸáŸà ŸÅŸä ÿßŸÑŸáŸàŸäÿ©" />
                                            </div>
                                            <div className="space-y-1.5">
                                                <label className="text-[10px] text-gray-400 font-bold px-1 uppercase">ÿ±ŸÇŸÖ ŸÖŸàÿ®ÿßŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ŸÑŸÖ</label>
                                                <input type="tel" value={transferForm.mobile} onChange={e => setTransferForm({ ...transferForm, mobile: e.target.value })} className="app-input text-sm num-en" placeholder="09xx xxx xxx" />
                                            </div>
                                            <div className="space-y-1.5">
                                                <label className="text-[10px] text-gray-400 font-bold px-1 uppercase">ŸÖŸÑÿßÿ≠ÿ∏ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©</label>
                                                <textarea value={transferForm.notes} onChange={e => setTransferForm({ ...transferForm, notes: e.target.value })} className="app-input text-sm h-28 py-3 resize-none" placeholder="ÿ£Ÿä ÿ™ŸÅÿßÿµŸäŸÑ ÿ£ÿÆÿ±Ÿâ ÿ®ÿÆÿµŸàÿµ ÿßŸÑÿßÿ≥ÿ™ŸÑÿßŸÖ..." />
                                            </div>
                                        </div>

                                        <button onClick={handleSendTelegram} className="btn-primary w-full py-4 font-bold bg-[#229ED9] border-none shadow-xl shadow-[#229ED9]/20 flex items-center justify-center gap-2">
                                            <IconRenderer icon={Icons.Telegram} />
                                            ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿπÿ®ÿ± ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ
                                        </button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };



            return (
                <div className="min-h-screen bg-gray-50 dark:bg-slate-950 w-full md:max-w-7xl mx-auto relative transition-all duration-300">
                    <InstallPrompt />
                    {showSplash && <SplashScreen />}

                    {activeTab === 'home' && renderHome()}
                    {activeTab === 'gold' && renderGold()}
                    {activeTab === 'calc' && renderCalculator()}
                    {activeTab === 'settings' && renderSettings()}
                    {activeTab === 'transfer' && renderTransfer()}
                    {activeTab === 'global' && renderGlobal()}
                    {activeTab !== 'transfer' && activeTab !== 'settings' && <NavBar activeTab={activeTab} setActiveTab={setActiveTab} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>
